<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Dave Wang]]></title><description><![CDATA[Dave Wang blogs about code]]></description><link>http://iapploft.net</link><generator>RSS for Node</generator><lastBuildDate>Thu, 12 Jul 2018 09:49:51 GMT</lastBuildDate><item><title><![CDATA[Mistakes Were Made]]></title><description><![CDATA[Last weekend, I was  bamboozled  for a while when working through a Python problem, which seems to be worth sharing. Background Before going…]]></description><link>http://iapploft.net/bak/2018-06-19-mistakes-were-made/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-06-19-mistakes-were-made/</guid><pubDate>Wed, 19 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Last weekend, I was &lt;em&gt;bamboozled&lt;/em&gt; for a while when working through a Python problem, which seems to be worth sharing.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;&lt;a href=&quot;#background&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Background&lt;/h2&gt;
&lt;p&gt;Before going into that, let’s talk about short-circuit operators for some background. Most Pythonistas would know that the boolean operators, &lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;or&lt;/code&gt; are &lt;a href=&quot;https://docs.python.org/3/library/stdtypes.html#boolean-operations-and-or-not&quot;&gt;short-circuit operators&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;do_something&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;I love Python!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; do_something&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
I Love Python!
&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; do_something&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# &quot;I love Python!&quot; is not printed above&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;When the result of a boolean operator can be derived from the left side argument, Python cleverly avoids evaluating the other argument.&lt;/p&gt;
&lt;h2 id=&quot;messing-with-pointers&quot;&gt;&lt;a href=&quot;#messing-with-pointers&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Messing with Pointers&lt;/h2&gt;
&lt;p&gt;In this toy example, we will create a &lt;code class=&quot;language-text&quot;&gt;change_pointer&lt;/code&gt;  function. Using a one element list as a pointer, &lt;code class=&quot;language-text&quot;&gt;change_pointer(pointer)&lt;/code&gt; will set the element to &lt;code class=&quot;language-text&quot;&gt;True&lt;/code&gt;, and return &lt;code class=&quot;language-text&quot;&gt;True&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;change_pointer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Changing pointer!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;case0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    result_pointer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Take a moment to walk through the code and deduce the output of &lt;code class=&quot;language-text&quot;&gt;case0()&lt;/code&gt; before going to the next section.&lt;/p&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; case0&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;If you got it correctly, great! Why is this so?&lt;/p&gt;
&lt;p&gt;Let’s look at the return statement:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Referring to the left and right sides of the boolean operator &lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt; as &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; is bound to the value &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;, the first element of &lt;code class=&quot;language-text&quot;&gt;result_pointer&lt;/code&gt; even before the &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; bound to &lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt; executes. Because of short-circuit evaluation, &lt;code class=&quot;language-text&quot;&gt;change_pointer&lt;/code&gt; does not even execute! (Notice that “Changing pointer!” is not printed as well)&lt;/p&gt;
&lt;p&gt;How can we get this function to return &lt;code class=&quot;language-text&quot;&gt;True&lt;/code&gt; instead then?&lt;/p&gt;
&lt;h2 id=&quot;working-around-short-circuit-evaluation&quot;&gt;&lt;a href=&quot;#working-around-short-circuit-evaluation&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Working Around Short-circuit Evaluation&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;case2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    result_pointer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-text&quot;&gt;case2()&lt;/code&gt;, we will evaluate &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt; before passing them to the boolean &lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt;, so that &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; will be forced to be evaluated.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; case2&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Changing pointer!
&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;However, the return value of &lt;code class=&quot;language-text&quot;&gt;case2()&lt;/code&gt; is still &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;, because &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; has already been bound to &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt; &lt;em&gt;value&lt;/em&gt; even before &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; executes; Changing the elements of &lt;code class=&quot;language-text&quot;&gt;result_pointer&lt;/code&gt; will have no effect.&lt;/p&gt;
&lt;h2 id=&quot;swapping-the-order&quot;&gt;&lt;a href=&quot;#swapping-the-order&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Swapping the Order&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;case3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    result_pointer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;If we want to use the elements of &lt;code class=&quot;language-text&quot;&gt;result_pointer&lt;/code&gt; only after &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; has been evaluated, &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; should only be bound &lt;em&gt;after&lt;/em&gt; the execution of &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt;. We can also clean up the code to take advantage of short-circuit evaluation should it be desired:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;case4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    result_pointer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# run change_pointer() first&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The results are:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; case3&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Changing pointer!
&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; case4&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Changing pointer!
&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2 id=&quot;going-deeper&quot;&gt;&lt;a href=&quot;#going-deeper&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Going Deeper&lt;/h2&gt;
&lt;p&gt;Since I was playing around with the &lt;a href=&quot;https://docs.python.org/3/library/dis.html&quot;&gt;disassembler&lt;/a&gt; module the other day, I thought it would be interesting to add in a section to see what goes on behind the scenes, specifically for &lt;code class=&quot;language-text&quot;&gt;case1()&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;case4()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Running &lt;code class=&quot;language-text&quot;&gt;dis(func)&lt;/code&gt; shows us the instructions that will be executed in the course of running &lt;code class=&quot;language-text&quot;&gt;func&lt;/code&gt;. Here’s what each column represents:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;The line number, for the first instruction of each line&lt;/li&gt;
&lt;li&gt;The current instruction, indicated as &lt;code class=&quot;language-text&quot;&gt;--&amp;gt;&lt;/code&gt; (Not shown in our example above)&lt;/li&gt;
&lt;li&gt;A labelled instruction, indicated with &lt;code class=&quot;language-text&quot;&gt;&amp;gt;&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The address of the instruction&lt;/li&gt;
&lt;li&gt;The operation code name (&lt;a href=&quot;https://docs.python.org/3/library/dis.html#python-bytecode-instructions&quot;&gt;Reference List&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Operation parameters&lt;/li&gt;
&lt;li&gt;Interpretation of the parameters in parentheses.
&lt;a href=&quot;https://docs.python.org/3/library/dis.html#dis.disco&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let’s try to understand what happens here, for the return statement.&lt;/p&gt;
&lt;h3 id=&quot;case1&quot;&gt;&lt;a href=&quot;#case1&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;case1()&lt;/code&gt;&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; dis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;case1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;           &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; LOAD_CONST               &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; BUILD_LIST               &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; STORE_FAST               &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;           &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; LOAD_FAST                &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; LOAD_CONST               &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; BINARY_SUBSCR
             &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; JUMP_IF_FALSE_OR_POP    &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt; LOAD_GLOBAL              &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;change_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; LOAD_FAST                &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt; CALL_FUNCTION            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; RETURN_VALUE&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOAD_FAST&lt;/code&gt; pushes the reference for &lt;code class=&quot;language-text&quot;&gt;result_pointer&lt;/code&gt; onto the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[result_pointer]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;LOAD_CONST&lt;/code&gt; pushes &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt;, the index accessor onto the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[result_pointer, 0]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;BINARY_SUBSCR&lt;/code&gt; takes the top of the stack and uses it to access values from the second element on the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[result_pointer, 0, result_pointer[0]]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JUMP_IF_FALSE_OR_POP&lt;/code&gt; checks the top of the stack (&lt;code class=&quot;language-text&quot;&gt;result_pointer[0]&lt;/code&gt;). If it is &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;, it causes a jump to instruction &lt;code class=&quot;language-text&quot;&gt;20&lt;/code&gt; (which is the return value).&lt;/li&gt;
&lt;li&gt;Instructions &lt;code class=&quot;language-text&quot;&gt;14&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;16&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;18&lt;/code&gt; call the &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; function with its parameters, which leaves the result on top of the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[result_pointer, 0, result_pointer[0], change_pointer(result_pointer)]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;RETURN_VALUE&lt;/code&gt; returns the boolean value on top of the stack&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We can see here a few things that reflect the analysis earlier:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The value of &lt;code class=&quot;language-text&quot;&gt;result_pointer[0]&lt;/code&gt; is bound to the parameters of the boolean operator; whether &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; is called does not affect it’s value on the stack&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JUMP_IF_FALSE_OR_POP&lt;/code&gt; will skip execution of &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; should the value on top of the stack be &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt; — short-circuit evaluation&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;case4&quot;&gt;&lt;a href=&quot;#case4&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;case4()&lt;/code&gt;&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; dis&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;case4&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token number&quot;&gt;54&lt;/span&gt;           &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; LOAD_CONST               &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; BUILD_LIST               &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; STORE_FAST               &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;token number&quot;&gt;56&lt;/span&gt;           &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; LOAD_GLOBAL              &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;change_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; LOAD_FAST                &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; CALL_FUNCTION            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; JUMP_IF_FALSE_OR_POP    &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt; LOAD_FAST                &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; LOAD_CONST               &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt; BINARY_SUBSCR
        &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; RETURN_VALUE&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;Instructions &lt;code class=&quot;language-text&quot;&gt;6&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;8&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt; call the &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; function with its parameters, which leaves the result on top of the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[change_pointer(result_pointer)]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;JUMP_IF_FALSE_OR_POP&lt;/code&gt; checks the top of the stack (&lt;code class=&quot;language-text&quot;&gt;change_pointer(result_pointer)&lt;/code&gt;). If it is &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;, it causes a jump to instruction &lt;code class=&quot;language-text&quot;&gt;20&lt;/code&gt; (which is the return value)&lt;/li&gt;
&lt;li&gt;Similarly to steps 1, 2, and 3 above for &lt;code class=&quot;language-text&quot;&gt;case0&lt;/code&gt;, instructions &lt;code class=&quot;language-text&quot;&gt;14&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;16&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;18&lt;/code&gt; pushes the value of &lt;code class=&quot;language-text&quot;&gt;result_pointer[0]&lt;/code&gt; onto the stack. Current Stack: &lt;code class=&quot;language-text&quot;&gt;[change_pointer(result_pointer), result_pointer, 0, result_pointer[0]]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;RETURN_VALUE&lt;/code&gt; returns the boolean value on top of the stack&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here, we see that &lt;code class=&quot;language-text&quot;&gt;change_pointer()&lt;/code&gt; is called before any elements from &lt;code class=&quot;language-text&quot;&gt;result_pointer&lt;/code&gt; are pushed onto the stack, so their values can be mutated before the final result is returned.&lt;/p&gt;
&lt;h2 id=&quot;difference-between-and-and-&quot;&gt;&lt;a href=&quot;#difference-between-and-and-&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Difference between &lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;On the side, it’s also worth noting that there is a difference between using the logical &lt;code class=&quot;language-text&quot;&gt;and&lt;/code&gt; operator and the bitwise &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&lt;/code&gt; operators.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;a&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# b() will not be called if a() is True&lt;/span&gt;

a&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# b() will be called irregardless of the result of a()&lt;/span&gt;

result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# vs&lt;/span&gt;
result &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# No short circuit evaluation&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2 id=&quot;final-notes&quot;&gt;&lt;a href=&quot;#final-notes&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Final Notes&lt;/h2&gt;
&lt;p&gt;I came across this problem when I was trying to recursively iterate across a tree while extracting out values into a global variable. It might be obvious in simple examples, but these errors are easy to overlook in larger pieces of code.&lt;/p&gt;
&lt;p&gt;This is also why using &lt;a href=&quot;https://www.wikiwand.com/en/Pure_function&quot;&gt;pure functions&lt;/a&gt; are much safer and can help us avoid such pitfalls. It’s pretty stupid to do so for the previous example, but it can be written in this contrived manner:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pure_change_pointer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Changing pointer! (Not really)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;case5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    result_pointer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    return_val&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; new_result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pure_change_pointer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result_pointer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; new_result

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result_pointer&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;and&lt;/span&gt; return_val&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Hopefully you’ll learn something from this post, and avoid making the same mistakes as me. Let me know if you have any feedback at &lt;a href=&quot;https://twitter.com/jiahaog&quot;&gt;@jiahaog&lt;/a&gt;!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;I used Python &lt;code class=&quot;language-text&quot;&gt;3.6.5&lt;/code&gt; for the examples in this article, but the concepts here should apply for Python 2 as well.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[一个简单双向链表-内容倒置]]></title><description><![CDATA[双向链表比基础链表结构多了一个前置指针。 链表对象 添加元素 内容倒置 逻辑很简单就是把 前置和后继 指针做一下交换 测试 github地址： https://github.com/davewang/ddlink.git]]></description><link>http://iapploft.net/blog/2018-06-19-ddlink/</link><guid isPermaLink="false">http://iapploft.net/blog/2018-06-19-ddlink/</guid><pubDate>Sat, 21 Apr 2018 21:33:20 GMT</pubDate><content:encoded>&lt;hr&gt;
&lt;h3 id=&quot;双向链表比基础链表结构多了一个前置指针。&quot;&gt;&lt;a href=&quot;#%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8%E6%AF%94%E5%9F%BA%E7%A1%80%E9%93%BE%E8%A1%A8%E7%BB%93%E6%9E%84%E5%A4%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E5%89%8D%E7%BD%AE%E6%8C%87%E9%92%88%E3%80%82&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;双向链表比基础链表结构多了一个前置指针。&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;
      &lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3 id=&quot;链表对象&quot;&gt;&lt;a href=&quot;#%E9%93%BE%E8%A1%A8%E5%AF%B9%E8%B1%A1&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;链表对象&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;
      &lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; dd_link
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;head&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;tail&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3 id=&quot;添加元素&quot;&gt;&lt;a href=&quot;#%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;添加元素&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;
      &lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dd_link &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;bool first &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//需要复制 node内容需要malloc 这里不做内容复制只做逻辑处理&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;first&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      node&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; tmp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      n&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tmp&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      tmp&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;p &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      node&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; tmp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      n&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;p &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tmp&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3 id=&quot;内容倒置-逻辑很简单就是把-前置和后继-指针做一下交换&quot;&gt;&lt;a href=&quot;#%E5%86%85%E5%AE%B9%E5%80%92%E7%BD%AE-%E9%80%BB%E8%BE%91%E5%BE%88%E7%AE%80%E5%8D%95%E5%B0%B1%E6%98%AF%E6%8A%8A-%E5%89%8D%E7%BD%AE%E5%92%8C%E5%90%8E%E7%BB%A7-%E6%8C%87%E9%92%88%E5%81%9A%E4%B8%80%E4%B8%8B%E4%BA%A4%E6%8D%A2&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;内容倒置 逻辑很简单就是把 前置和后继 指针做一下交换&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;
      &lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//交换&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;swap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
  node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;temp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
  x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; temp&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//倒置&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rever&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dd_link &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  node&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;old_head&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; old_root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    node &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;tmp_n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    n &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; n&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;swap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tmp_n&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;tmp_n&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
  link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;head &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  link&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;tail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; old_head&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;测试&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;
      &lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;   
   dd_link link &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   link&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   link&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tail &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   
   node node1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   node1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

   node node2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   node2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   
   node node3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   node3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

   &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;node2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;node1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;true&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;node3&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

   &lt;span class=&quot;token function&quot;&gt;loop_print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;rever&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;after rever\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;loop_print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;link&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;github地址：&lt;a href=&quot;https://github.com/davewang/ddlink.git&quot;&gt;https://github.com/davewang/ddlink.git&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Integrating and Building All the Things For My Website!]]></title><description><![CDATA[This article is the second of a two part series, on the engineering behind my  website To have beyond the best user experience possible, but…]]></description><link>http://iapploft.net/bak/2018-02-25-integrating-and-building-all-the-things/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-02-25-integrating-and-building-all-the-things/</guid><pubDate>Sun, 25 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is the second of a two part series, on the engineering behind my &lt;a href=&quot;https://jiahao.codes&quot;&gt;website&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;To have beyond the best user experience possible, but also the most streamlined process possible when adding content such as blog posts, I &lt;del&gt;over-&lt;/del&gt;engineered my website to be a fully fledged production-ready progressive web app. I tried to integrate as many tools and automated pipelines as needed to ensure long maintainability of the codebase, and also to update myself on frontend web development. There needs to be separation of concerns between the code and the content, and adding new content should be as simple as possible without requiring a single line of Javascript code to be modified.&lt;/p&gt;
&lt;p&gt;I’ll talk about the following features and integrations set up in this article:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#progressive-web-application-pwa&quot;&gt;Progressive Web Application&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#progressive-web-application-pwa&quot;&gt;Offline mode with Service Workers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#responsive-images&quot;&gt;Responsive images for all device types&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#search-engine-optimization-seo&quot;&gt;Search Engine Optimization&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#the-new-website&quot;&gt;Written with React in ES2015+ Javascript using the Gatsby framework&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#styled-components&quot;&gt;Styling with Styled Components and Typography.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#linting-rules&quot;&gt;ESLint and Stylelint code quality checks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#code-formatting-with-prettier&quot;&gt;Code formatting with Prettier&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#continuous-integration&quot;&gt;Continuous Integrations and Deployment pipelines&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#continuous-deployment&quot;&gt;Hosted at edge locations over a Content Delivery Network with Netlify&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#monitoring&quot;&gt;Monitoring with Sentry&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;application-features&quot;&gt;&lt;a href=&quot;#application-features&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Application Features&lt;/h2&gt;
&lt;p&gt;I started off with the &lt;a href=&quot;https://github.com/noahg/gatsby-starter-blog-no-styles&quot;&gt;gatsby-starter-blog-no-styles&lt;/a&gt; which was a minimal version of the &lt;a href=&quot;https://github.com/gatsbyjs/gatsby-starter-blog&quot;&gt;official starter blog&lt;/a&gt;, and added on to it to build my website. section, I’ll go into the technical details of the features of the source code and application.&lt;/p&gt;
&lt;h3 id=&quot;progressive-web-application-pwa&quot;&gt;&lt;a href=&quot;#progressive-web-application-pwa&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Progressive Web Application (PWA)&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://developers.google.com/web/progressive-web-apps/&quot;&gt;PWAs&lt;/a&gt; are web applications which behave like native applications on all devices, worthy of “a place on the user’s home screen”. Of course, this might be overkill for a simple website or blog, but why not build it with the features of a PWA if it gives speed and reliability? Gatsby already generates for us a basic PWA out of the box —  only the &lt;a href=&quot;https://www.gatsbyjs.org/packages/gatsby-plugin-offline/&quot;&gt;offline&lt;/a&gt; and &lt;a href=&quot;https://www.gatsbyjs.org/packages/gatsby-plugin-manifest/&quot;&gt;web manifest&lt;/a&gt; plugins need to be dropped in to complete it.&lt;/p&gt;
&lt;p&gt;Offline support is provided using browser &lt;a href=&quot;https://developers.google.com/web/fundamentals/primers/service-workers/&quot;&gt;Service Workers&lt;/a&gt;, allowing the site to function for returning visitors without an internet connection. It’s worth noting that this is &lt;a href=&quot;https://caniuse.com/#feat=serviceworkers&quot;&gt;not fully supported&lt;/a&gt; by all the browser vendors, such as Safari as of today. The good news is that it will arrive with &lt;a href=&quot;https://developer.apple.com/library/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_11_1.html&quot;&gt;iOS 11.3&lt;/a&gt;!&lt;/p&gt;
&lt;h3 id=&quot;search-engine-optimization-seo&quot;&gt;&lt;a href=&quot;#search-engine-optimization-seo&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Search Engine Optimization (SEO)&lt;/h3&gt;
&lt;p&gt;I use the SEO term broadly here, including metadata annotations so that social media websites know how to display the content properly on their platform. It comes in a few forms:&lt;/p&gt;
&lt;h4 id=&quot;google-structured-data&quot;&gt;&lt;a href=&quot;#google-structured-data&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://developers.google.com/search/docs/guides/intro-structured-data&quot;&gt;Google Structured Data&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;For SEO and enhanced search&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I’m still working on this part as it involves more work in understanding the &lt;a href=&quot;https://schema.org/&quot;&gt;Schema.org&lt;/a&gt; format to generate annotations automatically.&lt;/p&gt;
&lt;h4 id=&quot;facebooks-open-graph-protocol&quot;&gt;&lt;a href=&quot;#facebooks-open-graph-protocol&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;http://ogp.me/&quot;&gt;Facebook’s Open Graph Protocol&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 68.84328358208955%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAADiklEQVQ4y3WR7U+bZRTG+x/4wUATgVL6PE9bkAqUMhggb30ZIIyXbbANsRmILspEnBs4p7Gj0E4Qo8gYBIVFWSTMOZaFTSIJJFv2YSbG+A9oggMCLS9GhAT4eWh0fjDeyZVz7nNOrvu6zq1ruhjE2dJPSWCCkuHvKft6DvfYrGCOkm8fUD45h+vzO3jGZqi7PUfj0DieU+24T3bgbvgYd/1l3NWtFBXXUVXzOrqiGi8xBWcw1vaQEbxB5eRDPA9+xnjzIYbh71AmZii8NYvt0xsYvV0YDnoxpNcTl9+G4fm3ibNLnughRikgOdWDznOkCWNuLZZSH0knunH0TeK89wj71CMhnKbs/k8MLyziuX4PrbQNc+7LaIXnUJ3vomU1oqQeRkspx2TOJzVDCF3VZzHY3ah5zZgOnsf0zjXir81i9t/kmZ7bnJr9kd5f50n7aAIl7zXUXEHRBZTsZiGrRrGVoSW6MKpZpKQXonMfaceQXIKafRIlpw3t/Ciq7NHU+iXx742TPXoL1+R94o9dQs3woolVNedNTGk1QibqEkWMJZsE5QBpjtJ9y7KL5GMyXIYpsxm16Srq4DTKZzPEvvEFnsAIzu4x4tIb0LLPCFkrCfYTmGwVQuaJkGnWPBSzE3tGhSisOktcihfVUYuS1YDi9KNekc/on8VyvBf7aR+OhjaSi1rEwVti83hEmbqvTIhUsWt+thiTpZA0EaVzHW7GYKsTha+gZOzbfh9T5x1M/ikcTQFSWjpIP+fHXnORhDSvkFVESFSrEy2pGDXJI9EthC5RWCmWK1swJh/Fmnkac2Yj2oEWtA/uorVPoR4KorpaZL+t8lgTmnyC2XZI8AJWUWmxlQpKsD5XGrHvyCxHl1NQz1MxRei1KqItLxGtvkhUzQhR3kmibRfQW18l2uolyugm2pCPPr4QvUEQm4c+ThCbjT4mk6f1qSjWHHRXBr7C1zmALzhCR/d1wTi+vmkuDf+A/5O7+Hq+wd89SkdwUDBER9dVOiUPfDhE4PIAXcF+AgJ/Vx/dvYPotre3WFhcILSyzMb6GsvLS5Iv8Xj+F1YkD4eXWdzvh0KShyKzm5t/8H9Ht7HxO/O/PWZpaZnllRCh8Cqra+ushMKR+9r6BisSV1fXniAsM6FwOBJX5KH9/ubmJjs7u/sKt+XyZ6SwtbXF3u4uu39jb++fuPek9m/vv7WdnR3+AiPEowSc6ucJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Facebook Sample Post&quot;
        title=&quot;&quot;
        src=&quot;/static/facebook-sample-post-80ea256efeb8a9a20b45343b2a881d10-059a1.png&quot;
        srcset=&quot;/static/facebook-sample-post-80ea256efeb8a9a20b45343b2a881d10-e5e74.png 185w,
/static/facebook-sample-post-80ea256efeb8a9a20b45343b2a881d10-caf3c.png 370w,
/static/facebook-sample-post-80ea256efeb8a9a20b45343b2a881d10-059a1.png 740w,
/static/facebook-sample-post-80ea256efeb8a9a20b45343b2a881d10-d2aa4.png 1072w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Example post when shared on Facebook&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&quot;twitter-cards&quot;&gt;&lt;a href=&quot;#twitter-cards&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.twitter.com/en/docs/tweets/optimize-with-cards/overview/abouts-cards&quot;&gt;Twitter Cards&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 80.36437246963563%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADwUlEQVQ4y4WUa0xURxTH+d4vTaMQRVjg3mUBeaugixBAihKs1dYPaFFpQYGFEgNNA4UClld8tWmqRGpsSFOS+miCFIgtikbTh9IWaECBXVhgWaACu+zyFIFfh92SqunjJP97Zu4985s5c3OOw+joY8bHJ9BqdQwahpi0WLBYp1jCbssv+H+ypaUlFhcXbd7BZDIzPT2NeWIcq3mcmUkTc9ZJFqanmBXj+SkL81YLi3MztvnclJVZ8W1uZpr52Smh6efgDiuPxaWnNP/0Gw0/P6ShVUtDp57rHX1cb9fR0D1Aw0Mdda3d1Hf1ceuRlsZ7D6htvEfdrV+pv/kLTbfv09T8A50izgY0i50D44/guqcEr5xqomvuEne7DfmbH3H/ognVlZtsrm5EVV6DZ0IB7tsSUYQfxy0qD8WWZNw27mSNcyjHNHl2oMlsJShmP+5RGfjsrSCk7Gt2NNxnc1Mrzpe+51BLJ+V9AwTkX0QKO4YcrkGKKUBWpyEFvI5nwGs4K0JJz8xdPeEMgZGHcQvdi6TOwf2tsyi+bEZZXsuGU7VkPeggR6Qsp5xGCn0HKToXSZxQCtqP5BePyieGdRsCSM94fxU4JYCpuAXuQt6WhnzgY5Q1d5AKLqPI+4roqzcIOVeHYnsaSnUmcsR7eAQfELDdyF7RKL3VrHfZhCazcBUoUo7UoPB/AykkASm2BPmTeqTP7+KSXEnsiSo2JX2EIigF5fZsATuIh98eZO8dyKowVBtjRMrhpL/7DDAwIkUseNsODBGL8q/ice4O/kdOEZxdylZNPr6xeSKLQ0i+u+0w7yhkn52o/Hax3k2N5llgcEQSHkFJeG49inJLKvLxK8gnbuCfeBKvg7l4v5mHSp2KMmAvnr6xqHzjBCjeBvMOjMfVI5KMrKK//rLJguy/j1cUcTh5JeIkJeC47zMcs75jje8HOHodZa3yMGvdXsXJNQInRRROLpFC4UJhrHMN46WXfUhKzrYDZ2fnOHnmIh+WVFFUUU1xRQ1FnzZSWN1K0ZlvKT59Tby7RHFZpdAFiksrKa2ooqzigvDnhT9PYfFZLl+rx2Gl/lbMYjGj79MyZOhndGQIo0FPX08HA3otI8ZBent7GDYaMA4NotN2/2tdOywv28t+ZGSUlpYW2tra6erqoqOjk7b233nU1c3goIGeHi0G0TyMw8P09/ej1+ttc4PBgE7Xy8SESTSH5b+BFqsVw5CR0T8eM2QcZmxsTHShccxmM6sx/2fPAZ8sPGX+yQLzwq+MXwxcuZr/1rJNfwK6ApzdQFkoxgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Twitter Sample Card&quot;
        title=&quot;&quot;
        src=&quot;/static/twitter-sample-card-559dce8feab0bbfcf7bcd9fee84008b1-059a1.png&quot;
        srcset=&quot;/static/twitter-sample-card-559dce8feab0bbfcf7bcd9fee84008b1-e5e74.png 185w,
/static/twitter-sample-card-559dce8feab0bbfcf7bcd9fee84008b1-caf3c.png 370w,
/static/twitter-sample-card-559dce8feab0bbfcf7bcd9fee84008b1-059a1.png 740w,
/static/twitter-sample-card-559dce8feab0bbfcf7bcd9fee84008b1-b7a6f.png 988w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Example post when shared on Twitter&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;As I wanted the addition of new content to be entirely automated without having to modify any code, any metadata tags should be automatically generated for new pages. To do this, I took reference from the &lt;a href=&quot;https://github.com/Vagr9K/gatsby-advanced-starter/blob/e8ed51ef9b7c3fcb28fa9b15e2b61c75e6b70757/src/components/SEO/SEO.jsx&quot;&gt;SEO component&lt;/a&gt; of the &lt;a href=&quot;https://github.com/Vagr9K/gatsby-advanced-starter&quot;&gt;gatsby-advanced-starter&lt;/a&gt;, to build a React component implementing the relevant metadata tags for our site pages in our document head.&lt;/p&gt;
&lt;p&gt;I wired everything up, such that the frontmatter for a post will be automatically be processed and converted into the relevant &lt;code class=&quot;language-text&quot;&gt;&amp;lt;meta /&amp;gt;&lt;/code&gt; tags in the document head. Take a look at the example of my first post at &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/blob/master/src/pages/blog/2018-01-22-hello-world/index.md&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;src/pages/blog/2018-01-22-hello-world/index.md&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;
      &lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token hr punctuation&quot;&gt;---&lt;/span&gt;
title: Hello Blog World!
date: 2018-01-22
path: /blog/hello-world/
excerpt: &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;console.log(&apos;Hello Blog World!&apos;);&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;code&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token title important&quot;&gt;cover: ./cover.jpg
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;&lt;/span&gt;

Content here...&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The frontmatter (the portion enclosed within the &lt;code class=&quot;language-text&quot;&gt;---&lt;/code&gt; block) will be converted to the following tags in the document head:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;
      &lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Document head at https://jiahao.codes/blog/hello-world/ simplified for brevity --&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;description&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&amp;lt;code&gt;console.log(&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;);&amp;lt;/code&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://jiahao.codes/static/cover-8c4020dc58b7d8763a6ba5ab6d6e587e-52613.jpg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Google Structured Data --&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;application/ld+json&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@context&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http://schema.org&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;WebSite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://jiahao.codes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Jia Hao&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;alternateName&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Jia Hao&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Facebook Open Graph --&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;og:url&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://jiahao.codes/blog/hello-world/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;og:type&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;og:title&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;og:description&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&amp;lt;code&gt;console.log(&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;);&amp;lt;/code&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;og:image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://jiahao.codes/static/cover-8c4020dc58b7d8763a6ba5ab6d6e587e-52613.jpg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;fb:app_id&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- Twitter Card --&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:card&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;summary_large_image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:site&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@jiahaog&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:creator&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;@jiahaog&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:title&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:description&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&amp;lt;code&gt;console.log(&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;Hello Blog World!&lt;span class=&quot;token punctuation&quot;&gt;&apos;&lt;/span&gt;);&amp;lt;/code&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;meta&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;twitter:image&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://jiahao.codes/static/cover-8c4020dc58b7d8763a6ba5ab6d6e587e-52613.jpg&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;I also wanted to point out the &lt;a href=&quot;https://github.com/nfl/react-helmet&quot;&gt;React Helmet&lt;/a&gt; library which makes modifying the document head a breeze with React APIs. Once again, there is a &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-react-helmet&quot;&gt;Gatsby plugin&lt;/a&gt; for this, supporting server-side rendering to add the correct tags into the static HTML output.&lt;/p&gt;
&lt;h3 id=&quot;responsive-images&quot;&gt;&lt;a href=&quot;#responsive-images&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Responsive Images&lt;/h3&gt;
&lt;p&gt;As I’ve discussed earlier above, delivering the optimal images for the correct devices is important to ensure that the site loads quickly and does not slow down when there are too many images on the page. A workflow is created so that images will automatically be resized into thumbnails of appropriate sizes, &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/00c4ca64a64233cb3e91dbf25e7f2c0dd928f82b/packages/gatsby-image&quot;&gt;Gatsby Image&lt;/a&gt; will use a “blur-up” technique to display a preview of the image while it loads, like how &lt;a href=&quot;https://medium.com/&quot;&gt;Medium&lt;/a&gt; displays images on articles. I won’t go into the details, but &lt;a href=&quot;https://medium.com/@kyle.robert.gill/ridiculously-easy-image-optimization-with-gatsby-js-59d48e15db6e&quot;&gt;this blog post&lt;/a&gt; provides an in-depth explanation of how to do so.&lt;/p&gt;
&lt;h2 id=&quot;development&quot;&gt;&lt;a href=&quot;#development&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Development&lt;/h2&gt;
&lt;p&gt;All Javascript is written in &lt;a href=&quot;https://github.com/tc39/proposals/blob/master/finished-proposals.md&quot;&gt;ES2015+ syntax&lt;/a&gt; and transpiled to ES5 for older browsers by &lt;a href=&quot;https://babeljs.io/&quot;&gt;Babel&lt;/a&gt;. I also integrated many tools and libraries that make development easier.&lt;/p&gt;
&lt;h3 id=&quot;styled-components&quot;&gt;&lt;a href=&quot;#styled-components&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Styled Components&lt;/h3&gt;
&lt;p&gt;I really like the API of &lt;a href=&quot;https://www.styled-components.com/&quot;&gt;Styled Components&lt;/a&gt;. It allows raw HTML tags to be “augmented” with styles as stateless components that can be reused, and composed together to build larger components. Take a look at the following component for my about page:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;
      &lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; styled &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;styled-components&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; GitHub&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Twitter &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./svgs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; SocialLinks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; styled&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;div&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`
  text-align: right;
`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Simplified for brevity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;AboutPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  social&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; githubUrl&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; twitterUrl &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;SocialLink&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;githubUrl&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;GitHub&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;SocialLink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;SocialLink&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;twitterUrl&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Twitter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;SocialLink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Styled Components lets me create a &lt;code class=&quot;language-text&quot;&gt;&amp;lt;div&amp;gt;&lt;/code&gt; for my social icons styled with &lt;code class=&quot;language-text&quot;&gt;text-align: right&lt;/code&gt;, and reuse them as containers for the SVG icons. Class names will be automatically generated on a global stylesheet which will target these components when compiled.&lt;/p&gt;
&lt;p&gt;Adapting this example from the &lt;a href=&quot;https://www.styled-components.com/docs/basics#adapting-based-on-props&quot;&gt;official documentation&lt;/a&gt;, it’s even possible to create them with props with different properties.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;
      &lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; styled &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;styled-components&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Button &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; styled&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;button&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`
  /* Adapt the colours based on primary prop */
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;  color: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;primary &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;red&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;;
&lt;/span&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Buttons&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Normal&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;Button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;primary&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Primary&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;Button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Because of the ternary operator, the button with the &lt;code class=&quot;language-text&quot;&gt;primary&lt;/code&gt; attribute will have red text, while the other button will be white.&lt;/p&gt;
&lt;h3 id=&quot;typography&quot;&gt;&lt;a href=&quot;#typography&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Typography&lt;/h3&gt;
&lt;p&gt;Initially for styling, I wanted to start off with the tried and true &lt;a href=&quot;https://getbootstrap.com/&quot;&gt;Bootstrap&lt;/a&gt; as a base to build the application. However, the Gatsby tutorial &lt;a href=&quot;https://www.gatsbyjs.org/tutorial/part-two/#typographyjs&quot;&gt;introduced me&lt;/a&gt; to &lt;a href=&quot;http://kyleamathews.github.io/typography.js/&quot;&gt;Typography.js&lt;/a&gt;, a great toolkit to add normalized styling to a website with readability in mind. I simply picked a &lt;a href=&quot;https://github.com/KyleAMathews/typography.js/tree/master/packages/typography-theme-fairy-gates&quot;&gt;theme&lt;/a&gt;, tweaked the fonts and was rewarded with beautiful design for the page!&lt;/p&gt;
&lt;p&gt;On top of using the library, I had to inject some &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/blob/master/src/styles/globals.css&quot;&gt;global markup&lt;/a&gt; myself to ensure that the HTML rendered from markup is pixel perfect. Minor changes needed to be made to the text colors, block quotes, to give the site some flavor.&lt;/p&gt;
&lt;p&gt;For syntax highlighting in code blocks, a theme needs to be added as well. Symbols within the code were already broken down into spans with the appropriate classname annotations by the markdown transformer, but it’s still necessary to use drop in a CSS theme from &lt;a href=&quot;https://github.com/PrismJS/prism&quot;&gt;PrismJS&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;During this process of digging around the generated CSS, I realized how underlining text in CSS is not as trivial as it sounds. Compare the two anchor elements below. Which one looks better?&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 16.591422121896162%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAeElEQVQI161NWw6DMAzr/W/HeI2WV6GlaNJ4Fn69JLsCkSzHjuwoPDzKuhOm3fE2G3RDXG+oux1NfyCvVhQE3kcfhbvhRGsPwUAea85zxs8XlAsXXsWCJP9KWalXGDqKpidZuSAlzJ8bmoJc0I9/uBDFc1OUQkveD29Q4oAGP1xxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Text Underline Comparison&quot;
        title=&quot;&quot;
        src=&quot;/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-059a1.png&quot;
        srcset=&quot;/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-e5e74.png 185w,
/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-caf3c.png 370w,
/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-059a1.png 740w,
/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-d8e4c.png 1110w,
/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-eae4a.png 1480w,
/static/text-underline-comparison-6fc74a14d3cad0c218bea829458816c8-90221.png 1772w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  &lt;/p&gt;
&lt;p&gt;The text on the left is styled conventionally with &lt;code class=&quot;language-text&quot;&gt;text-decoration: underline&lt;/code&gt;. On the right, the styling is done with a combination of &lt;code class=&quot;language-text&quot;&gt;background-image&lt;/code&gt; to insert the thin line and &lt;code class=&quot;language-text&quot;&gt;text-shadow&lt;/code&gt;, adding the appearance of depth, making letters appear in front of the line. &lt;a href=&quot;https://medium.design/crafting-link-underlines-on-medium-7c03a9274f9&quot;&gt;This article&lt;/a&gt; goes into detail about how it is done on Medium — I never thought so much thought and effort went into making websites look &lt;em&gt;nice&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It seems like the current implementation is still not perfect on the Safari browser, I’ll have to fix this.&lt;/p&gt;
&lt;h3 id=&quot;code-formatting-with-prettier&quot;&gt;&lt;a href=&quot;#code-formatting-with-prettier&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Code formatting with Prettier&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://prettier.io/&quot;&gt;Prettier&lt;/a&gt; is a code formatter to keep indentation, brackets, comma conventions and more standard in the codebase. By integrating it with &lt;a href=&quot;https://github.com/prettier/vim-prettier&quot;&gt;vim-prettier&lt;/a&gt;, I configured my editor to automatically format my code when I save any files. It’s awesome and &lt;em&gt;life changing&lt;/em&gt;. I remember after being pampered by Prettier and &lt;a href=&quot;https://golang.org/cmd/gofmt/&quot;&gt;Gofmt&lt;/a&gt;, the code formatter for Go, I just had to find code formatters for other programming languages I use.&lt;/p&gt;
&lt;h3 id=&quot;linting-rules&quot;&gt;&lt;a href=&quot;#linting-rules&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Linting Rules&lt;/h3&gt;
&lt;p&gt;For linting, I use &lt;a href=&quot;https://eslint.org/&quot;&gt;ESLint&lt;/a&gt; configured to follow the &lt;a href=&quot;https://github.com/airbnb/javascript&quot;&gt;Airbnb Javascript style guide&lt;/a&gt; with the &lt;a href=&quot;https://github.com/yannickcr/eslint-plugin-react&quot;&gt;React plugin&lt;/a&gt;. As far as possible, I tried to follow the &lt;a href=&quot;https://github.com/airbnb/javascript/tree/master/react&quot;&gt;Airbnb React style guide&lt;/a&gt; as well. CSS files are linted with &lt;a href=&quot;https://stylelint.io/&quot;&gt;Stylelint&lt;/a&gt;, following their &lt;a href=&quot;https://github.com/stylelint/stylelint-config-standard&quot;&gt;standard rules&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It took quite a bit of time to refactor the original project to follow these rules. It also turns out that since I’m using Prettier, I needed to use the &lt;a href=&quot;https://github.com/prettier/eslint-config-prettier&quot;&gt;Prettier ESLint config&lt;/a&gt; to turn off some of the rules. I didn’t know that at first and it took a bit of Googling to figure out.&lt;/p&gt;
&lt;h3 id=&quot;tests&quot;&gt;&lt;a href=&quot;#tests&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tests&lt;/h3&gt;
&lt;p&gt;Most of my tests are written as snapshot tests, with the &lt;a href=&quot;https://facebook.github.io/jest/&quot;&gt;Jest&lt;/a&gt; test framework, and &lt;a href=&quot;https://github.com/airbnb/enzyme&quot;&gt;Enzyme&lt;/a&gt; to serialize the components. This is because there’s barely any logic in the code and the React components are all pure and stateless. It just adds a layer of security to ensure that code changes which cause the snapshots to break are noticed, for me to either update the snapshots or fix the breaking changes.&lt;/p&gt;
&lt;h2 id=&quot;continuous-integration&quot;&gt;&lt;a href=&quot;#continuous-integration&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Continuous Integration&lt;/h2&gt;
&lt;p&gt;Continuous integration means that automated processes are set up so that code checked into the remote Git repository are of quality and will not break when going to production. Typically, it involves running of tests when the remote is updated, so that breaking builds are detected and can be fixed quickly. With the multiple tools and services available &lt;em&gt;free&lt;/em&gt; for open source projects, I was able to try some of them out, targeting different areas of code quality.&lt;/p&gt;
&lt;h3 id=&quot;tests-and-linting-with-travis-ci&quot;&gt;&lt;a href=&quot;#tests-and-linting-with-travis-ci&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tests and Linting with Travis CI&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/&quot;&gt;Travis CI&lt;/a&gt; is used to run linting and Javascript tests upon a &lt;code class=&quot;language-text&quot;&gt;git push&lt;/code&gt;.  This ensures that errors can be detected upon small deltas to the code. It’s better to fix them when they are found, instead of detecting them on production, or after large amounts of code have been added which can be a huge pain.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 34.9146110056926%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABDElEQVQoz22RSW7DMAxFdf8rddsDZNEuWjTLOrE8yLU1T78iExtJUQIflGTq8YsW3aVD13Xo+x7jMGCeJl4boyEvEq/nF8j4DYpSC2qtvKa86zFEcB5609BaQzkHE0Lbbwgtl1IQUss1P136C4kxNgOGs7jqATEn7q5DhG5Q15RSut++KbUaEy1yyQzkZq0p1dGaMkmc5AfUZmCtQW0f/B1IRY9ufAzo1a05Rc4Zy7KwyBmPpN0Rb+MXlmbXe8dF1loG0hNIu9PQgOM6PQHXdWVRDTWmM/E+nrFZdwC994foSSQ+Z+D8L5AcHsCT/IRcfviv7g53l5TJJUFd8LhM1wNIM1VKYZ5nbr7P9ReBYCFMbbve+wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;List of Travis Builds&quot;
        title=&quot;&quot;
        src=&quot;/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-059a1.png&quot;
        srcset=&quot;/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-e5e74.png 185w,
/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-caf3c.png 370w,
/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-059a1.png 740w,
/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-d8e4c.png 1110w,
/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-eae4a.png 1480w,
/static/travis-builds-5e4fbfc78089e8341f756960086dfcaa-ef69b.png 2108w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;&lt;a href=&quot;https://travis-ci.org/jiahaog/jiahao.codes/builds&quot;&gt;List of builds for the project&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;coverage-visualization-with-codecov&quot;&gt;&lt;a href=&quot;#coverage-visualization-with-codecov&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Coverage Visualization with Codecov&lt;/h3&gt;
&lt;p&gt;Coverage reports are sent to &lt;a href=&quot;https://codecov.io/&quot;&gt;Codecov&lt;/a&gt; at the end of the Travis CI builds, which provides a nice visualization of test coverage history &lt;a href=&quot;https://codecov.io/gh/jiahaog/jiahao.codes&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 63.862660944206006%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQ4y3WS25LbIAyG/f5P1dve7Uwzs42z8SbOaRLbxDZgzvwVJM52m1TMN8K/DAKhgrErjucW50uDpuugtYH3PhNCeMy/ac4hAJCLE4afFYaxh2hayL5HIeQENiqwfkDPBbTxSBZjzBsk/zezlsw19P+e0RoNrzWsUiiMMXDWQnAOIQTS93wSKWX2s6WNZm3WjXdZSynSuiIHc9bwuOJ8mmSKsvJ7ssTX7nhphXUek3HgysLnrPP1KAHh6ATW2QcpZuiKY6TrLi8Qv3bgcoRoW2jB6craYZpsJs2t9rBUR+8inZy2T4S7J5LmbYBNG28HqIrBWlrDFRwdquh9j853OMkjNmyDbV9jN+xwlCewwHCN12fQo48ERoKnL9IGGiMK5ScILzDaEVdFP2sKmeHm7YApTq/Bs6ZiemWkR4lwVEclFSSXEKPI8+AC/mvxH+5asS5/YD9tsNcHLJvfKNuS/BKrbpXZcCqD3KKWNeqpxsEccIkX5BG/ONNoY4virGt8mBVKU+KNvWHBF3if3lHaElWoMuuwflDF6onP+AmKYBd3KD5Mhc526G2PVrXoVAemOzRTg5boSGOaYXBUdD9kL6hlqDDfSENGiaIRLTWuzK1iEtrn9rlx01LMUas8oJbyL3BU8z/9f+7jT53R6AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;CodeCov Commit&quot;
        title=&quot;&quot;
        src=&quot;/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-059a1.png&quot;
        srcset=&quot;/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-e5e74.png 185w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-caf3c.png 370w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-059a1.png 740w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-d8e4c.png 1110w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-eae4a.png 1480w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-189ee.png 2220w,
/static/codecov-commit-4ffc0edc537b826555dc5861b7f2b027-bf962.png 2330w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Lines covered by tests in a commit&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;It’s also especially useful in detecting lines of code which have not been covered by tests.&lt;/p&gt;
&lt;h3 id=&quot;code-quality-insights-with-code-climate&quot;&gt;&lt;a href=&quot;#code-quality-insights-with-code-climate&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Code Quality Insights with Code Climate&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://codeclimate.com/&quot;&gt;Code Climate&lt;/a&gt; provides insights into code smells such as repeated code that could be refactored.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 86.43649815043156%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAABq0lEQVQ4y41Uga6CMAzk/7/RaDSRCCIgMNgGo6/XUYNE9C05O7b11vY6kzRN6XQ60fl8psPhQMfjkdLrlS6XS5zzfl3X5JyjYRh+IinLkoCiKCjPcqrYuXzWVFWVrMO2bUtN01DXddT3/S5wLrHWyu3jOJLFLaOjwnXkvRdoZEqma5+AfSE0xoiTLA49dfyNTU1jnmfSsZ5vRwiBEqR0u90oz3N6PB6SJuZZlkkZ7ve7HPw0QK7AQJYJfjQ9TQd2mibSvbUgGvk2apyRCLGJYg7LQZRA66pEarGuFs7rCHG5EOIHDq311DBx35s35RDpr3TXSOAAQsPOVVmRaVjh0cumRvHfEQnZCeHOIYaNC8IUxMY6rqB13QDnXhEGLrrUhqOsraFqYLB9Wm4fbqF6mRsTYdGzkhWL5SNw2YvQL4QiBObOCpyPomAelV6EsvF7b7ypbJe2AFRRNL1dLNbVam+u+1AIw1JDN80SofYgCL8J8lVlkLRcH7wS/AngxSCKPadveBH2nAqeWVc1ZJ/mZ3vst83yvHo7iKoWAgRWcfLSEm6KQFnGTYt8wh85KzMIu/6wMgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Code Climate Issues&quot;
        title=&quot;&quot;
        src=&quot;/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-059a1.png&quot;
        srcset=&quot;/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-e5e74.png 185w,
/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-caf3c.png 370w,
/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-059a1.png 740w,
/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-d8e4c.png 1110w,
/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-eae4a.png 1480w,
/static/code-climate-issues-5706877ae31470b9bdedcfd48b734884-542f5.png 1622w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Possible areas which can be refactored&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Issues are automatically created indicating areas that can be refactored. Check out the project &lt;a href=&quot;https://codeclimate.com/github/jiahaog/jiahao.codes&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;dependency-management-with-greenkeeper-and-david-dm&quot;&gt;&lt;a href=&quot;#dependency-management-with-greenkeeper-and-david-dm&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dependency management with Greenkeeper and David DM&lt;/h3&gt;
&lt;p&gt;Keeping up-to-date with updates for dependencies is especially important in the Javascript world, be it for security fixes, bug fixes or new features. It’s usually easier to make small changes from time to time when there are breaking API changes with dependencies, rather than trying to make big updates and hoping nothing breaks.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://david-dm.org/&quot;&gt;David&lt;/a&gt; gives an &lt;a href=&quot;https://david-dm.org/jiahaog/jiahao.codes&quot;&gt;overview&lt;/a&gt; of dependencies to show them in a list and the possible versions that can be updated.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://greenkeeper.io/&quot;&gt;Greenkeeper&lt;/a&gt; automatically opens new pull requests to run tests when in-range npm dependencies have changed.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 84.11689961880559%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACf0lEQVQ4y3VTy27bQAzU/5/6E/2KHnrroSjQQ5HE8SO2ZUm7elrSavW0PCXprBIHiYABSYniDjlcrzJnHE4vOJ4OUEpju93hcDgiihSCICT/ILHWWqyKAqjtCpVp4J7r9br43p+fAb5/+4tfPzYIKHm32yOMIikeRhr7k0YQKpyiBOt9iGOgoSjOzgbluUTbtktRhqf9Bo+/Myi/xjgNmOcZwzBiHEdcLjO6nv0JLdlpvuJCZMYZmOjbZZok5/3jUQr6ycI0Nfq+l4KG2rFtJ8nMoK4Noab4Qizmhc1HzMzwn1VYtyls1SKKU2RFibJukBcF8ryQ2HbDjRkd0BNbjh2YeWWs/GOaFl41dagJZ/ox0jF0nCAmRFmDMO+QZAWSNBNENNdzWeFCrU/E9oaZRkWWMNIIPNd7QYxY1SzLiFkOP7E4pgMUsVaKFA8jHI++ML9X9nqntif9U2BtC/8U4ERFB2qryDP0XYvPns9nCJm/507iVg5+AJ2k4iudIk4LFGW9KOlyvxTFFeQ0UdMYUZJXpixLJFS8rCqJh2EQsP/V89YywTSNzFGTMFzIoSS2SXITSsexLLy1Vor3DFo1PoT9iUVxbbAYPENRmK6doqvGIkUkCMcOfIsYvn+6xSRWEIYiWEOkloIprwYx4hOZQUuL3TRWfEvjaF7t7dubbbtOvrHP41oK8qpwu5zIt4LBJ7KtKucbukVmiRnscw4TuZthRcPPslyS+Cd33VyBm61QfTjIUB53wvk8y4VhEAR4eHjEer3B09MKq9UzYS14Iv+Z35Pl7/xts9nKu9XzRt7tXvayyx5vOhflNUnTVMTh1odX1Zx9D2bi7PC6Uu7df++fF6WGmC7eAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Greenkeeper Example PR&quot;
        title=&quot;&quot;
        src=&quot;/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-059a1.png&quot;
        srcset=&quot;/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-e5e74.png 185w,
/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-caf3c.png 370w,
/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-059a1.png 740w,
/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-d8e4c.png 1110w,
/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-eae4a.png 1480w,
/static/greenkeeper-pr-60aafddd8264df67e17043ac8803ae9e-ef2f8.png 1574w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Automatically opened &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/pull/3&quot;&gt;pull request&lt;/a&gt; by Greenkeeper to update Stylelint&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This means in the future, when I have less time to dedicate to this blog, I can just look at the pull requests indicating dependency updates, and simply click the merge button when my tests pass.&lt;/p&gt;
&lt;h2 id=&quot;continuous-deployment&quot;&gt;&lt;a href=&quot;#continuous-deployment&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Continuous Deployment&lt;/h2&gt;
&lt;p&gt;To keep development of the website as simple as possible, I wanted merging code to the &lt;code class=&quot;language-text&quot;&gt;master&lt;/code&gt; branch to automatically deploy the updated web application. Using a content delivery network (CDN) to serve the content means that content is hosted at edge locations closest to the visitor, to minimize latency when serving them up. As they are free, I looked at &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt; and &lt;a href=&quot;https://www.netlify.com/&quot;&gt;Netlify&lt;/a&gt; to do this.&lt;/p&gt;
&lt;p&gt;I used GitHub Pages in the past for the original iteration of the website. Previously, I ran a script manually on my local machine to perform the build locally and deploy them to the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; remote branch, but this time I wanted it to be done remotely on a build server. GitHub Pages only allows you to do builds with a custom flavor of Jekyll, and I would have to set up my own pipeline to push the compiled web assets to the &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt; branch.&lt;/p&gt;
&lt;p&gt;That seemed like extra work, and Netlify doesn’t have these limitations. A build server is included for me — I just had to specify a build command and the directory for the output files.&lt;/p&gt;
&lt;p&gt;In addition, it supports HTTP/2 over HTTPS with just a few clicks on the Netlify website. I only had to setup my DNS records for &lt;code class=&quot;language-text&quot;&gt;jiahao.codes&lt;/code&gt;, and everything was good to go. All that win for free!&lt;/p&gt;
&lt;p&gt;This is important because HTTP/2 allows different required assets to be multiplexed over a single TCP connection, while HTTPS ensures that my website is delivered securely to users, preventing any ads or content being modified by any attackers. I learnt a lot about how these technologies work and matter in &lt;a href=&quot;https://hpbn.co/&quot;&gt;High Performance Browser Networking&lt;/a&gt; a book by Ilya Grigorik.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching&quot;&gt;Caching headers&lt;/a&gt; for the deployed static assets are also essential to minimize the number of network requests for returning visitors to the site. Netlify allows users to &lt;a href=&quot;https://www.netlify.com/docs/headers-and-basic-auth/#headers-and-basic-authentication&quot;&gt;define custom headers&lt;/a&gt; for this, which is helpfully available through… the &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/a3fea82b4d4b4c644156e841401821933e8d694a/packages/gatsby-plugin-netlify&quot;&gt;Gatsby Netlify plugin&lt;/a&gt; 🎉 !&lt;/p&gt;
&lt;h2 id=&quot;monitoring&quot;&gt;&lt;a href=&quot;#monitoring&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Monitoring&lt;/h2&gt;
&lt;p&gt;Once the website is in production at &lt;code class=&quot;language-text&quot;&gt;https://jiahao.codes&lt;/code&gt;, I needed a form of monitoring to ensure that the page functions correctly. &lt;a href=&quot;https://sentry.io/welcome/&quot;&gt;Sentry&lt;/a&gt; allows all client side Javascript errors to be reported remotely, and will appear on a dashboard as issues to be resolved, should there be any.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 57.22070844686649%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABVklEQVQoz5VSi27DIAzk/79yXZvlRYA0IQ0hyY1zStdpm9QhnWwjcz7bKD966LZDVTaoq1YsYY1DmAO2dcN/jrJ2xHD18OOEcfDJH3HtB7GMt23Dvu8vQzk7wHQWxtikitbAey/VmEBCqnwJKVf1rkf5UaFttLRpOgdnnSiMMR6Ef+BRkP62Iy4RKsQN0zRLe5zZEhbMyc53f13XRPwTS3p8S+9oGdMPKV8F3SSyES4pJQlnyRmyCH0mxfujDBZZQpTZk5Bx9lUoTriczji9ndG7KyZ/S0QJw4Sbn6UyW3s+Oc4t58MRqahrOFlIL2QkoFL6tCSdb0FAtc9bz4vIxFSqQlWgvJQoEnTTPdAS9WG5LCGcSfillgRZIUlF4VJe0FYNmlrLzIb++H+ylPt8kp5v7T4UPm2bWJNitRiN4r3AOUG3Bl1rhZiK8pZ//8SHQoL1eEcBn06vWotSOv48AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;List of Sentry Issues&quot;
        title=&quot;&quot;
        src=&quot;/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-059a1.png&quot;
        srcset=&quot;/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-e5e74.png 185w,
/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-caf3c.png 370w,
/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-059a1.png 740w,
/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-d8e4c.png 1110w,
/static/sentry-issues-bf8419a1a6b8afe0ff2fcae3c9db5f21-05565.png 1468w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;Javascript errors as issues&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I also set up a private &lt;a href=&quot;https://slack.com/&quot;&gt;Slack&lt;/a&gt; workspace to receive notifications about my project. Not only will alerts from Sentry be sent there, but also build and deployment notifications will also appear there on a channel dedicated for this project. It’s not the most minimal way to do this — you can find a hundred and one complaints about how Electron apps like Slack are resource intensive, but since I’m always signed into another Slack workspace, it is pretty easy to just add another workspace to receive these notifications.&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 57.301808066759385%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABYElEQVQoz6VTy07DMBDM//8Jf8ABcS4HxKVFQkKkoJbacR6Onfdr2HVxSFB7QESarC1nd8c7kyA3GrGSUJGiqJBrjb7rsHzKskSe5+j7Hh2dMYZhwDRNDm3bomladx6Ez0+4v73BQQiER4nIVJB55QpkmaZoKGZIkgTW2hnGMAyKolg1D4auxzETOEkBqSippm7D5FhUVY26ab4ZNA68Xu75O8+UEeyLCo+fEQ5hiEhKWGJWWoO6qvCXh4udGY4ThE3wKmK8HGPsPiJsCVFmriZegj8LeKEHi1inSFONlOYmdQFlG7puO4vA4Ksuk/16xVCJd+y2G5wECUJK5zTsiq7btj/z4mJ+fuM4OvwuPM9Q7N+webgjlU8ID2QfWyMpWmiyDyvLSrt1mrrocVY+dZZaqcyvHhOKsnAWYC8xA/bZJXiG1/YBd1j7y8z+Ws7vOnrUdQ1FPwXnBb667/RffAFd2Vbf1ZqrDQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;Slack channel showing build and deploy notifications&quot;
        title=&quot;&quot;
        src=&quot;/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-059a1.png&quot;
        srcset=&quot;/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-e5e74.png 185w,
/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-caf3c.png 370w,
/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-059a1.png 740w,
/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-d8e4c.png 1110w,
/static/slack-channel-5e1453a97851a6ef615c23c7c3235129-143df.png 1438w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;My Slack channel showing build and deploy notifications&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;future&quot;&gt;&lt;a href=&quot;#future&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Future&lt;/h2&gt;
&lt;p&gt;I’m still making minor touches to the code before adding a new photography page to this site. I previously used &lt;a href=&quot;https://web.archive.org/web/20150611134241/https://www.storehouse.co/&quot;&gt;Storehouse&lt;/a&gt; (Wayback Machine link) to showcase them, but I’m sad to say that they have &lt;a href=&quot;https://techcrunch.com/2016/06/13/storehouse-will-shut-down-services-july-15-entire-team-will-migrate-to-square/&quot;&gt;shut down&lt;/a&gt;. I’ll just have to build something similar then!&lt;/p&gt;
&lt;p&gt;I’ve been also looking at &lt;a href=&quot;https://www.netlifycms.org/&quot;&gt;Netlify Content Management System (CMS)&lt;/a&gt; which can provide my site with a application to add new content from the browser directly, just like hosted versions of Wordpress.&lt;/p&gt;
&lt;h2 id=&quot;summing-up&quot;&gt;&lt;a href=&quot;#summing-up&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Summing Up&lt;/h2&gt;
&lt;p&gt;I’m very proud to say that setting up everything is completely free, from the libraries and frameworks used to the hosting of the site, thanks to open source. It may seem like overkill doing all that to setup a simple website, but I’ve really learnt a lot about what it takes to scaffold a modern day web application from scratch.&lt;/p&gt;
&lt;p&gt;To be fair, I’m only standing on the shoulders of giants when I talk about all the amazing features and integrations above. Most of the work comes from hooking everything up and making sure everything works together nicely, ensuring that new content can be added seamlessly.&lt;/p&gt;
&lt;p&gt;This reminds me of this webcomic:&lt;/p&gt;
&lt;p&gt;
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 101.23915737298637%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAABibAAAYmwFJdYOUAAAChUlEQVQ4y3WTV29aQRCF9+fzF3gEJEAYCdHBFFMEiC6qArbB9F5Dd4B83A1ISex52Lu7d87MmTOz4qrY+XxuNpvFYtHtdkcikff391wul06n8/l8NBrNZDKJRCIYDIbD4Ww2+0sxUILP5+dno9Hwer0mkwmk2Wy22+2xWMzv9xOL48vLi9VqZaPX651OJxEXiwVAAWw6nfb7/Var1el0hsMh62g0gghgYFDo9Xpcdrtd6TMYDCaTyXg8FsAgcLlcrn/b4XCAbTKZfH19vX5jgjB81us15H8qBoyI5Pk/4r9geOI0n8/JoFKpqO3t7Y1Yu90O8l+SetyISqVSLpdBrlYrVnJ+fHyQHArIgSqn0wlSEkCdWq0WBxlCIB3qg5fNQG02y+USJBuj0ajT6RCZhgHYbrc2mw3Z/oBlzYSkE2q12uVygUcqLtHZYrHQ21AolEqloHA8Hrln3e/3t1ZJMJXLNtAhpEoqRj84IgE8IUKBPxSr1WqssBAQBt9ut1t3A0whz8/P3KPZ429HsfbdcBOIJD2Gd2M/m80oBDwqQHigGG5wYaIYL9Tl+O2QUGG1WoUqOeVfSiUbyZh5xvYGljVTvfSQa6lUcjgcZJY6UTDTzlSjP+LJ7txqlmDI0Nh4PI68PCmGGVXQieHBwePx4E3zvxhP0lIhrAwGA4+hXq/TCW4gTDh48mAfA48cZGKFkeDpwadQKGw2G2aDVCRkz30gEKDtPFVKhSRtgzwDQ8EajYZuCX6QGekJhoboCZ4Nsw2AVBfF5CAx+cB49k9PT1AWcvr5IWcYIxaZeRtHxfaKEYsQOMOLQuSECoQhA91HJ1RlZe/z+cggb7CmYhwhiJbywcLxN1faJBU5B1IQAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;&quot;
        alt=&quot;xkcd 1319 - Automation&quot;
        title=&quot;&quot;
        src=&quot;/static/xkcd-1319-27b3f23bb28b19b520ea31ebe9241792-059a1.png&quot;
        srcset=&quot;/static/xkcd-1319-27b3f23bb28b19b520ea31ebe9241792-e5e74.png 185w,
/static/xkcd-1319-27b3f23bb28b19b520ea31ebe9241792-caf3c.png 370w,
/static/xkcd-1319-27b3f23bb28b19b520ea31ebe9241792-059a1.png 740w,
/static/xkcd-1319-27b3f23bb28b19b520ea31ebe9241792-9fc5b.png 807w&quot;
        sizes=&quot;(max-width: 740px) 100vw, 740px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
&lt;em&gt;&lt;a href=&quot;https://xkcd.com/1319/&quot;&gt;xkcd/1319 - Automation&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Original task&lt;/strong&gt;: Revamp my website to blog about things*&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reality&lt;/strong&gt;: &lt;em&gt;Ongoing Development&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Hopefully this website will accompany me through my coding journey, inspiring to me to record down and share the things I’ve learnt. &lt;del&gt;Or I could start planning how to rewrite this in &lt;a href=&quot;https://github.com/gopherjs/gopherjs&quot;&gt;GopherJS&lt;/a&gt; / &lt;a href=&quot;http://elm-lang.org/&quot;&gt;Elm Lang&lt;/a&gt; / &lt;a href=&quot;https://www.rust-lang.org/en-US/&quot;&gt;Rust&lt;/a&gt; compiled to &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/WebAssembly&quot;&gt;WebAssembly&lt;/a&gt;.&lt;/del&gt; Hmmm…&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Check out the source code &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes&quot;&gt;here&lt;/a&gt;!&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;acknowledgements&quot;&gt;&lt;a href=&quot;#acknowledgements&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Acknowledgements&lt;/h2&gt;
&lt;p&gt;Many thanks to &lt;a href=&quot;https://github.com/glencbz&quot;&gt;Glen&lt;/a&gt; for reviewing this post, and &lt;a href=&quot;https://github.com/gilbarbara/logos&quot;&gt;gilbarbara/logos&lt;/a&gt; for the images in the cover image.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Why I Upgraded My Website to GatsbyJS]]></title><description><![CDATA[This article is the first of a two part series, on the engineering behind my  website For the past couple of weeks, I’ve been rebuilding my…]]></description><link>http://iapploft.net/bak/2018-02-24-why-i-upgraded-my-website/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-02-24-why-i-upgraded-my-website/</guid><pubDate>Sat, 24 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is the first of a two part series, on the engineering behind my &lt;a href=&quot;https://jiahao.codes&quot;&gt;website&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;For the past couple of weeks, I’ve been rebuilding my personal website from scratch, live at &lt;a href=&quot;https://jiahao.codes&quot;&gt;https://jiahao.codes&lt;/a&gt; with the source code on &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes&quot;&gt;GitHub&lt;/a&gt;. In this article, I’ll tell the story of this long overdue rewrite and talk about the new static site framework I eventually settled on, &lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;&lt;a href=&quot;#background&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Background&lt;/h2&gt;
&lt;p&gt;For a little bit of background, I originally built my website while I was an undergraduate back in 2016. It was a single page &lt;a href=&quot;https://reactjs.org/&quot;&gt;React&lt;/a&gt; application, with the concept based off an interactive search box where visitors can type in things. The application will then change based on what was typed in, to show projects I’ve done, like a website resume or portfolio. I tagged it on Git for posterity &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/releases/tag/1.0.0&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Some drawbacks were that the content was very coupled with the code to to style the page, and it was difficult to change the theme without having to rewrite a lot of code. It uses a customized version of &lt;a href=&quot;https://jsonresume.org/&quot;&gt;JSON Resume&lt;/a&gt; to display data, but ultimately I didn’t do a good job and it was a bit of a mess.&lt;/p&gt;
&lt;p&gt;Furthermore, being a single page application, it takes a little too long to load just to display some static content. I wanted to add routing and different pages to add blogging functionality, which it wasn’t really suitable for without major refactoring.&lt;/p&gt;
&lt;h2 id=&quot;first-iteration--jekyll&quot;&gt;&lt;a href=&quot;#first-iteration--jekyll&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;First Iteration — Jekyll&lt;/h2&gt;
&lt;p&gt;This led me to pick something very minimal and lightweight to rebuild it. In my time at &lt;a href=&quot;https://www.grab.com&quot;&gt;Grab&lt;/a&gt;, I worked a little on maintaining our &lt;a href=&quot;https://github.com/grab/engineering-blog&quot;&gt;engineering blog&lt;/a&gt; which was built on top of &lt;a href=&quot;https://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt;. I liked how minimal it was, you just had to pick a theme and drop in your posts in the &lt;a href=&quot;https://daringfireball.net/projects/markdown/&quot;&gt;markdown&lt;/a&gt; format. There is clear separation of concerns between the content and the site design.&lt;/p&gt;
&lt;p&gt;It’s nice that pages, layouts, and categories in Jekyll are just small building blocks that are composed together to build a website, making it easy to reason about how everything fits together. I picked the &lt;a href=&quot;https://github.com/poole/hyde&quot;&gt;Hyde&lt;/a&gt; theme to start off, and played around a little with the CSS to touch up a few areas.&lt;/p&gt;
&lt;p&gt;When delivering content to users on mobile devices, it is important to optimize delivery of images to the users. Users on smaller mobile devices should not need to load large image resources, but instead should load the appropriate image for their viewport. HTML5 specifies the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#attr-srcset&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;srcset&lt;/code&gt;&lt;/a&gt; attribute for &lt;code class=&quot;language-text&quot;&gt;&amp;lt;img/&amp;gt;&lt;/code&gt; tags which is ideal for this.&lt;/p&gt;
&lt;p&gt;However, it would be a pain to have to manually convert images into different sized thumbnails for a post. I wanted an automated image processing pipeline to automatically resize the images extracted from the markdown documents, and then automatically populate the &lt;code class=&quot;language-text&quot;&gt;srcset&lt;/code&gt; attribute on the images in the output HTML document. I found the &lt;a href=&quot;https://github.com/wildlyinaccurate/jekyll-responsive-image&quot;&gt;Jekyll Responsive Image Plugin&lt;/a&gt; great for this. It allows me to create templates which will be used by Jekyll when rendering the markdown and automatically does the image resizing.&lt;/p&gt;
&lt;p&gt;Even so, when I tried to do more complicated workflows like adding CSS preprocessing with dependence on the Javascript ecosystem with the &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;Node Package Manager (npm)&lt;/a&gt;, it became a lot more convoluted. Looking at a few recipes I’ve found, I would have to dive down the road of writing &lt;a href=&quot;https://gulpjs.com/&quot;&gt;Gulp&lt;/a&gt; workflows and somehow connect them to Jekyll commands. I also chanced upon the &lt;a href=&quot;https://github.com/matthodan/jekyll-asset-pipeline&quot;&gt;Jekyll Asset Pipeline&lt;/a&gt; which seems what I could use. I didn’t dive too deep into it, but from brief glances it seems like I would have to come up with a lot of custom scripting to interface with Javascript libraries on my own.&lt;/p&gt;
&lt;p&gt;I guess having used &lt;a href=&quot;https://webpack.js.org/&quot;&gt;webpack&lt;/a&gt; at work, I was pampered by the open source community where there are loaders and documented recipes for doing almost anything, granted that someone willing to wade into the world of Javascript fatigue. At the same time, &lt;a href=&quot;https://github.com/yangshun&quot;&gt;@yangshun&lt;/a&gt; introduced me to &lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt;, a React static site generator which seemed really fascinating. It’s also a good opportunity for me to get my hands dirty with frontend development again.&lt;/p&gt;
&lt;p&gt;As I had some free time on my hands, why not rewrite everything again and keep myself updated with the ever-changing Javascript ecosystem? Seems like a lot of fun!&lt;/p&gt;
&lt;h2 id=&quot;final-form--gatsby&quot;&gt;&lt;a href=&quot;#final-form--gatsby&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Final Form — Gatsby&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt; is a static site generator that can render sites from markup documents using templates defined as React components. It functions similarly to Jekyll, where you can pick a &lt;a href=&quot;https://github.com/gatsbyjs/gatsby-starter-blog&quot;&gt;starter project&lt;/a&gt;, &lt;a href=&quot;https://github.com/gatsbyjs/gatsby-starter-blog/blob/master/src/pages/hello-world/index.md&quot;&gt;drop in&lt;/a&gt; some markdown documents for articles, and &lt;a href=&quot;https://gatsbyjs.github.io/gatsby-starter-blog/&quot;&gt;be rewarded&lt;/a&gt; with a website with minimal effort.&lt;/p&gt;
&lt;p&gt;It offers much much more, however. With Gatsby, it allows me to leverage the modern tools of building web applications, to add interactive experiences for visitors like a fully fledged &lt;a href=&quot;https://reactjs.org/&quot;&gt;React&lt;/a&gt; application. Not only that, it is unlike traditional single page applications, and even works &lt;em&gt;without&lt;/em&gt; Javascript! Things would certainly be more complicated if I were to add a Javascript compilation pipeline to a Jekyll site, and a Javascript framework would be a better fit.&lt;/p&gt;
&lt;h3 id=&quot;how-it-works&quot;&gt;&lt;a href=&quot;#how-it-works&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How It Works&lt;/h3&gt;
&lt;p&gt;Let me briefly give a high level overview of how Gatsby works from my short experience using it.&lt;/p&gt;
&lt;p&gt;Developing the application is the same as developing a React application, with useful things like &lt;a href=&quot;https://webpack.js.org/guides/hot-module-replacement/&quot;&gt;hot module replacement&lt;/a&gt; to aid easy development already set up by Gatsby. What’s different is that there is a framework in place to use &lt;a href=&quot;http://graphql.org/&quot;&gt;GraphQL&lt;/a&gt; queries to access content outside the client side browser environment. With accompanying GraphQL queries defined for a React component, the component will be hydrated with the result of the query as props when it is rendered.&lt;/p&gt;
&lt;p&gt;For example, I defined a &lt;code class=&quot;language-text&quot;&gt;PostTemplate&lt;/code&gt; which will be used to render pages for articles.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;
      &lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// src/templates/Post.jsx&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;PostTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; markdownRemark&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; frontmatter&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; date &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; html &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;small&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;small&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;dangerouslySetInnerHTML&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; __html&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; html &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; pageQuery &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; graphql&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`
  query PostByPath($path: String!) {
    markdownRemark(frontmatter: { path: { eq: $path } }) {
      html
      frontmatter {
        title
        date
      }
    }
  }
`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;When the &lt;code class=&quot;language-text&quot;&gt;&amp;lt;PostTemplate /&amp;gt;&lt;/code&gt; component needs to be rendered into a page, the accompanying exported &lt;code class=&quot;language-text&quot;&gt;pageQuery&lt;/code&gt;, a GraphQL query is made, and the results are passed in as props into the component.&lt;/p&gt;
&lt;p&gt;The real magic happens when the website is compiled into a production bundle. Running &lt;code class=&quot;language-text&quot;&gt;gatsby build&lt;/code&gt; will tell Gatsby to perform all the GraphQL queries defined and render all the React components into a HTML document, using a technique known as server-side rendering. This means that everything “React” is serialized and compiled to static HTML, ready to be viewed without Javascript. Visitors to the site will then be able to quickly load and interact with the static version of the page.&lt;/p&gt;
&lt;p&gt;Not only that, within the HTML document, there are instructions to load the Javascript bundle of your application asynchronously. When it has been loaded, the content displayed in the browser will be dynamically replaced by the React application, gaining interactivity. This also happens with the other pages of your site — Gatsby will ensure that they are asynchronously loaded so that when you click on a link, the data is already cached on the browser for React to swap out the DOM elements that need to be changed. Everything is done to give the illusion of speed to the viewer while asynchronously loading everything in the background.&lt;/p&gt;
&lt;h3 id=&quot;plugins&quot;&gt;&lt;a href=&quot;#plugins&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Plugins&lt;/h3&gt;
&lt;p&gt;Because of the APIs exposed by Gatsby for interfacing with its internals, powerful plugins can be built to extend the core functionality of Gatsby and reducing work by developers.&lt;/p&gt;
&lt;h4 id=&quot;nodejs-apis&quot;&gt;&lt;a href=&quot;#nodejs-apis&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Node.js APIs&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Can be extended with a &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; file in the root of the project&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.gatsbyjs.org/docs/node-apis/&quot;&gt;Node.js APIs&lt;/a&gt; are basically the heavy lifting performed by the Node.js process when compiling the application. Callbacks can be defined to modify the GraphQL data that is provided to React components when they are rendered, and is used by plugins to extend the internals of Gatsby.The webpack config can also be customized here.&lt;/p&gt;
&lt;p&gt;Take the example of what happens during the processing of markdown files in &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/tree/master/src/pages&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;src/pages/&lt;/code&gt;&lt;/a&gt;. The &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/a3fea82b4d4b4c644156e841401821933e8d694a/packages/gatsby-source-filesystem&quot;&gt;Source Filesystem Plugin&lt;/a&gt; creates file nodes which will read from the directory. The output is then processed by the &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/a3fea82b4d4b4c644156e841401821933e8d694a/packages/gatsby-transformer-remark&quot;&gt;Transformer Remark Plugin&lt;/a&gt; , parsing the markup into HTML with the &lt;a href=&quot;https://remark.js.org/&quot;&gt;Remark&lt;/a&gt; markdown processor.&lt;/p&gt;
&lt;h4 id=&quot;server-side-rendering-apis&quot;&gt;&lt;a href=&quot;#server-side-rendering-apis&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Server-side Rendering APIs&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Can be extended with a &lt;code class=&quot;language-text&quot;&gt;gatsby-ssr.js&lt;/code&gt; file in the root of the project&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.gatsbyjs.org/docs/ssr-apis/&quot;&gt;server side rendering APIs&lt;/a&gt; allow hooks to be defined to modify the rendering process of the application. For example, the &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/00c4ca64a64233cb3e91dbf25e7f2c0dd928f82b/packages/gatsby-plugin-typography&quot;&gt;Typography.js Plugin&lt;/a&gt; uses this to &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/blob/ab1d7f50adcff5b7085e6236973b8c30083aa523/packages/gatsby-plugin-typography/src/gatsby-ssr.js#L11-L14&quot;&gt;inline the styles&lt;/a&gt; required into the DOM head when rendering.&lt;/p&gt;
&lt;h4 id=&quot;browser-apis&quot;&gt;&lt;a href=&quot;#browser-apis&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Browser APIs&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Can be extended with a &lt;code class=&quot;language-text&quot;&gt;gatsby-browser.js&lt;/code&gt; file in the root of the project&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally, the &lt;a href=&quot;https://www.gatsbyjs.org/docs/browser-apis/&quot;&gt;browser APIs&lt;/a&gt; allows lifecycle hooks of the web application to be modified. The &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/tree/ab1d7f50adcff5b7085e6236973b8c30083aa523/packages/gatsby-plugin-google-analytics&quot;&gt;Google Analytics Plugin&lt;/a&gt; &lt;a href=&quot;https://github.com/gatsbyjs/gatsby/blob/a3fea82b4d4b4c644156e841401821933e8d694a/packages/gatsby-plugin-google-analytics/src/gatsby-browser.js#L4-L5&quot;&gt;uses these APIs&lt;/a&gt; to track the location of the user on route changes.&lt;/p&gt;
&lt;p&gt;The best part about using Gatsby is that there plenty of plugins available leveraging these APIs that give us new features almost for free. Want to add offline mode to your application? RSS feeds? Styled components? Just lookup the &lt;a href=&quot;https://www.gatsbyjs.org/docs/plugins/#official-plugins&quot;&gt;available plugins&lt;/a&gt; and drop them into the &lt;a href=&quot;https://github.com/jiahaog/jiahao.codes/blob/master/gatsby-config.js&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt;&lt;/a&gt;!&lt;/p&gt;
&lt;h2 id=&quot;next-steps&quot;&gt;&lt;a href=&quot;#next-steps&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Next Steps&lt;/h2&gt;
&lt;p&gt;In the &lt;a href=&quot;/blog/integrating-and-building-all-the-things/&quot;&gt;follow up post&lt;/a&gt;, I will showcase the amazing integrations and features I have set up, to be on the cutting edge of web development!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[About Me]]></title><description><![CDATA[Hi! I’m Dave Wang. 随便写写.记录日常生活及收获，而已。 这个Blog用的这个哥们现成 jiahao.codes 改的.]]></description><link>http://iapploft.net/about/</link><guid isPermaLink="false">http://iapploft.net/about/</guid><pubDate>Tue, 06 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Hi! I’m Dave Wang. 随便写写.记录日常生活及收获，而已。&lt;/p&gt;
&lt;p&gt;这个Blog用的这个哥们现成&lt;a href=&quot;https://github.com/jiahaog/jiahao.codes&quot;&gt;jiahao.codes&lt;/a&gt;改的.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Deep Dive into Database Timeouts in Rails]]></title><description><![CDATA[This article was originally published on  Grab’s Engineering Blog A couple of weeks ago, we had a production outage for one of our internal…]]></description><link>http://iapploft.net/bak/2018-01-29-deep-dive-into-database-timeouts-in-rails/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-01-29-deep-dive-into-database-timeouts-in-rails/</guid><pubDate>Mon, 29 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article was originally published on &lt;a href=&quot;https://engineering.grab.com/deep-dive-into-database-timeouts-in-rails&quot;&gt;Grab’s Engineering Blog&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;A couple of weeks ago, we had a production outage for one of our internal Ruby on Rails application servers. One of the databases that the application connects to had a failover event. It was expected that the server should continue functioning for endpoints which do not depend on this database, but it was observed that our server slowed down to a crawl, and was unable to function properly even after the failover completed, until we manually restarted the servers.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;&lt;a href=&quot;#background&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Background&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://guides.rubyonrails.org/active_record_basics.html&quot;&gt;ActiveRecord&lt;/a&gt; is the canonical ORM for Rails to access a database. Different requests are handled on different threads, so a connection pool is necessary to maintain a limited set of connections to the database and also to skip the additional latency of establishing a TCP connection.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A connection pool synchronizes thread access to a limited number of database connections. The basic idea is that each thread checks out a database connection from the pool, uses that connection, and checks the connection back in.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;It will also handle cases in which there are more threads than connections: if all connections have been checked out, and a thread tries to checkout a connection anyway, then ConnectionPool will wait until some other thread has checked in a connection.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Source: The &lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/ConnectionPool.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ActiveRecord::Connection Pool&lt;/code&gt;&lt;/a&gt; .&lt;/p&gt;
&lt;h3 id=&quot;options-for-the-connection-pool&quot;&gt;&lt;a href=&quot;#options-for-the-connection-pool&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Options for the Connection Pool&lt;/h3&gt;
&lt;p&gt;In Rails, database configurations are set in the &lt;code class=&quot;language-text&quot;&gt;config/database.yml&lt;/code&gt; file. These options are either native to the &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::ConnectionPool&lt;/code&gt; module, or passed to the underlying adapter, depending on whether MySQL or PostgreSQL is used.&lt;/p&gt;
&lt;p&gt;ActiveRecord uses connection adapters to make database calls. For MySQL, it uses the &lt;a href=&quot;https://github.com/brianmario/mysql2&quot;&gt;mysql2&lt;/a&gt; library, which depends on the &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/c-api-implementations.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;libmysqlclient&lt;/code&gt;&lt;/a&gt; C library. The following options affect the behaviour of the library:&lt;/p&gt;
&lt;h4 id=&quot;pool&quot;&gt;&lt;a href=&quot;#pool&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;pool&lt;/code&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Native to the &lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/ConnectionPool.html&quot;&gt;ActiveRecord ConnectionPool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Default 5 - &lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/ConnectionPool.html#class-ActiveRecord::ConnectionAdapters::ConnectionPool-label-Options&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This specifies the maximum number of connections to the database that ActiveRecord will maintain per server.&lt;/p&gt;
&lt;h4 id=&quot;checkout_timeout&quot;&gt;&lt;a href=&quot;#checkout_timeout&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;checkout_timeout&lt;/code&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Native to the &lt;a href=&quot;http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/ConnectionPool.html&quot;&gt;ActiveRecord ConnectionPool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Default 5 seconds - &lt;a href=&quot;https://github.com/rails/rails/blob/e5dc756bf9424086c403d1025971c3e704e1dcfa/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L328&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When making a ActiveRecord call, ActiveRecord tries to checkout a database connection from the pool. If the pool is at maximum capacity, ActiveRecord will wait for this timeout to elapse before raising an &lt;code class=&quot;language-text&quot;&gt;ActiveRecord::ConnectionTimeoutError&lt;/code&gt; exception.&lt;/p&gt;
&lt;h4 id=&quot;connect_timeout&quot;&gt;&lt;a href=&quot;#connect_timeout&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Native to the &lt;a href=&quot;https://github.com/brianmario/mysql2&quot;&gt;mysql2&lt;/a&gt; library, passed to &lt;code class=&quot;language-text&quot;&gt;libmysqlclient&lt;/code&gt; as &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/mysql-options.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;MYSQL_OPT_CONNECT_TIMEOUT&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Default 120 seconds - &lt;a href=&quot;https://github.com/brianmario/mysql2/blob/a1c198ee4c8d4d32dfa79f207ec7d0524c5f7bcc/lib/mysql2/client.rb#L31&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If there are no available connections to the database in the connection pool, a new connection will have to be established. &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; , specifies the timeout to establish a new connection to the database before failing.&lt;/p&gt;
&lt;h4 id=&quot;read_timeout&quot;&gt;&lt;a href=&quot;#read_timeout&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Native to the &lt;a href=&quot;https://github.com/brianmario/mysql2&quot;&gt;mysql2&lt;/a&gt; library, passed to &lt;code class=&quot;language-text&quot;&gt;libmysqlclient&lt;/code&gt; as &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/mysql-options.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;MYSQL_OPT_READ_TIMEOUT&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Default 3 × 10 minutes - &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/mysql-options.html&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Read timeout is used by the &lt;code class=&quot;language-text&quot;&gt;libmysqlclient&lt;/code&gt; library to identify whether the MySQL client is still alive and sending data. As we know that TCP sends data in chunks, the client waits for this timeout when reading from the socket, before deeming that there is an error and closing the connection.&lt;/p&gt;
&lt;h3 id=&quot;connection-pooling-algorithm&quot;&gt;&lt;a href=&quot;#connection-pooling-algorithm&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Connection Pooling Algorithm&lt;/h3&gt;
&lt;p&gt;The following pseudocode is the algorithm for how ActiveRecord retrieves connections from the pool to perform database queries.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;
      &lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; there are existing connections to the database available&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; one of the existing connections

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; the pool &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; at capacity&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    wait on the queue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; exception &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; `checkout_timeout` has elapsed
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; one of the now available connections

&lt;span class=&quot;token comment&quot;&gt;# pool is not at capacity&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; to create a new connection&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; exception &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; `connect_timeout` has elapsed

&lt;span class=&quot;token comment&quot;&gt;# connection to database established&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; new connection&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This is loosely translated from the &lt;a href=&quot;https://github.com/rails/rails/blob/f8c00c130016b248d1d409f131356632dcc418c6/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb#L725-L749&quot;&gt;source code&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;replicating-and-debugging&quot;&gt;&lt;a href=&quot;#replicating-and-debugging&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Replicating and Debugging&lt;/h2&gt;
&lt;p&gt;Let’s try to replicate the problem in a small Rails application. We will create a new Rails application, connect it to a database, run it in a Docker container and finally run some experiments to replicate the problem. In production, we use &lt;a href=&quot;https://github.com/puma/puma&quot;&gt;Puma&lt;/a&gt; to run our Rails server and connect to a few MySQL databases managed by &lt;a href=&quot;https://aws.amazon.com/rds/&quot;&gt;Amazon Relational Database Service (RDS)&lt;/a&gt;, so we will try to follow that on our local setup.&lt;/p&gt;
&lt;h3 id=&quot;step-1-create-a-new-rails-application&quot;&gt;&lt;a href=&quot;#step-1-create-a-new-rails-application&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Step 1: Create a new Rails Application&lt;/h3&gt;
&lt;p&gt;First, we will scaffold a fresh Rails application and connect it to two databases that we will call as &lt;code class=&quot;language-text&quot;&gt;db_main&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# the flags removes unwanted boilerplate code&lt;/span&gt;
rails new rails-mysql-timeouts --database&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;mysql --api -M -C -S -J -T&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;For simplicity, we will set the &lt;code class=&quot;language-text&quot;&gt;thread_count&lt;/code&gt; of our Puma server to &lt;code class=&quot;language-text&quot;&gt;2&lt;/code&gt;, in &lt;code class=&quot;language-text&quot;&gt;config/puma.rb&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;
      &lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;threads_count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Using &lt;code class=&quot;language-text&quot;&gt;rails generate scaffold&lt;/code&gt;, we set up a &lt;code class=&quot;language-text&quot;&gt;Driver&lt;/code&gt; model to talk to our main database, and a &lt;code class=&quot;language-text&quot;&gt;Passenger&lt;/code&gt; model to talk to another database we want to test the failure on. This can be done by adding the following line to our &lt;code class=&quot;language-text&quot;&gt;Passengers&lt;/code&gt; model.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;
      &lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Passenger&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationRecord&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# connect to #{Rails.env}_other database specified in the database.yml&lt;/span&gt;
  establish_connection &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;Rails&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;_other&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_sym
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;We now have the following HTTP routes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# connects to db_main
GET /drivers/1

# connects to db_other
GET /passengers/1&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now we will run our Rails server with the following environment variables&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;export&lt;/span&gt; RAILS_ENV&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;production
&lt;span class=&quot;token function&quot;&gt;export&lt;/span&gt; RAILS_LOG_TO_STDOUT&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1

rails server&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;By using a docker container to run the Rails application, we can isolate the process namespace and focus directly on our application. We run &lt;code class=&quot;language-text&quot;&gt;ps&lt;/code&gt; and observe the two threads we have configured puma — &lt;code class=&quot;language-text&quot;&gt;puma 001&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;puma 002&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt; -T -e
  PID  SPID TTY          TIME CMD
    1     1 ?        00:00:00 &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;
   30    30 pts/1    00:00:00 &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;
   63    63 pts/0    00:00:00 &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;
   97    97 pts/1    00:00:03 ruby
   97    99 pts/1    00:00:00 ruby-timer-thr
   97   105 pts/1    00:00:00 tmp_restart.rb*
   97   106 pts/1    00:00:00 puma 001
   97   107 pts/1    00:00:00 puma 002
   97   108 pts/1    00:00:00 reactor.rb:152
   97   109 pts/1    00:00:00 thread_pool.rb*
   97   110 pts/1    00:00:00 thread_pool.rb*
   97   111 pts/1    00:00:00 server.rb:327
  112   112 pts/0    00:00:00 &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Note that PID 1 is &lt;code class=&quot;language-text&quot;&gt;sleep&lt;/code&gt; because in &lt;a href=&quot;https://github.com/grab/blogs/tree/master/2017-01-29-deep-dive-into-database-timeouts-in-rails/docker-compose.yml&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt;&lt;/a&gt;, we specified that the container should start with &lt;code class=&quot;language-text&quot;&gt;cmd: sleep infinity&lt;/code&gt; so that we can attach to the running container at any time, not unlike a &lt;code class=&quot;language-text&quot;&gt;ssh&lt;/code&gt; to a machine.&lt;/p&gt;
&lt;h3 id=&quot;step-2-verify-our-application&quot;&gt;&lt;a href=&quot;#step-2-verify-our-application&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Step 2: Verify Our Application&lt;/h3&gt;
&lt;p&gt;We make the following requests to ensure that our server is working correctly:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/drivers
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test driver&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/passengers
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-01-01T00:00:00.000Z&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-01-07T00:00:00.000Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Great! We are now able to see the records generated in the database by the above curl requests.&lt;/p&gt;
&lt;p&gt;The entire source code for this application can be found &lt;a href=&quot;https://github.com/grab/blogs/tree/master/2017-01-29-deep-dive-into-database-timeouts-in-rails&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;step-3-simulating-the-production-issue&quot;&gt;&lt;a href=&quot;#step-3-simulating-the-production-issue&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Step 3: Simulating the Production Issue&lt;/h3&gt;
&lt;p&gt;We will now try to simulate the production issue by using a proxy to monitor all our TCP connections from our Rails application to our database. Finally, we will run some experiments by sending requests that hit the backend database and analyse the behaviour of both &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; settings.&lt;/p&gt;
&lt;p&gt;First, we use &lt;a href=&quot;https://github.com/Shopify/toxiproxy&quot;&gt;Toxiproxy&lt;/a&gt; as a transport layer proxy to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt; which allows us to manipulate the pipe between the client and the upstream database. The following command stops all data from getting the proxy, and closes the connection after timeout.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;toxiproxy-cli toxic add db_other_proxy --toxicName &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt; --type &lt;span class=&quot;token function&quot;&gt;timeout&lt;/span&gt; --attribute&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;timeout&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;100000&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now we test if things are still working for endpoints that access the unaffected database.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/drivers
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test driver&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This is expected, as the &lt;code class=&quot;language-text&quot;&gt;db_main&lt;/code&gt; is still running. Let’s trigger a request to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/passengers&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;We notice that the command does not exit and our terminal blocks while waiting for the command to terminate.&lt;/p&gt;
&lt;p&gt;Let’s trigger another call to &lt;code class=&quot;language-text&quot;&gt;db_main&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/drivers
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;test driver&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;updated_at&quot;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;2017-11-05T11:59:15.000Z&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Seems like it still works! Now let’s make another request to the &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt; to lock up the two threads our server is configured to use.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/passengers&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;And make another request to &lt;code class=&quot;language-text&quot;&gt;db_main&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:3000/drivers&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Notice that the call to &lt;code class=&quot;language-text&quot;&gt;/drivers&lt;/code&gt; is stuck and does not complete now. Because we have set the thread count to &lt;code class=&quot;language-text&quot;&gt;2&lt;/code&gt;, and have two &lt;code class=&quot;language-text&quot;&gt;/passengers&lt;/code&gt; requests in flight, both threads are stuck waiting for the database and we do not have any more threads available to handle the new request, hence the stalled &lt;code class=&quot;language-text&quot;&gt;/drivers&lt;/code&gt; request.&lt;/p&gt;
&lt;p&gt;This is exactly what happened during our production outage, except on a much larger scale.&lt;/p&gt;
&lt;h3 id=&quot;experiments&quot;&gt;&lt;a href=&quot;#experiments&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Experiments&lt;/h3&gt;
&lt;p&gt;Let’s perform some experiments to better understand how &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; work. We will set the timeouts to the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;
      &lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;+ connect_timeout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
+ read_timeout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;In the following section we will perform two experiments.&lt;/p&gt;
&lt;h4 id=&quot;experiment-1-application-has-no-existing-connections-before-database-failure&quot;&gt;&lt;a href=&quot;#experiment-1-application-has-no-existing-connections-before-database-failure&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Experiment 1: Application has no Existing Connections before Database Failure&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Stop data transmission to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Start Rails&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We first block data to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt; , so that on the first ActiveRecord call to retrieve some data from the database, there are no available connections in the connection pool and it needs to establish a fresh connection to the database when it receives the first &lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt; request.&lt;/p&gt;
&lt;h4 id=&quot;experiment-2-application-has-existing-connections-before-database-failure&quot;&gt;&lt;a href=&quot;#experiment-2-application-has-existing-connections-before-database-failure&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Experiment 2: Application has Existing Connections before Database Failure&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Start Rails&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Stop data transmission to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We’ve started Rails and make a call to &lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;. A connection to the database is established to retrieve the data, and checked back into the pool as an available connection after the request.&lt;/p&gt;
&lt;p&gt;Now, when the proxy stops sending data to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;, ActiveRecord does not know that the database is unavailable and believes that the previously checked in connection is available for use with the second &lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We can use the &lt;a href=&quot;http://man7.org/linux/man-pages/man8/ss.8.html&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;ss&lt;/code&gt;&lt;/a&gt; command to observe the TCP connections. When Rails has just been started, there are no existing TCP connections .&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# shows TCP connections with the PID&lt;/span&gt;
$ ss -tnp&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;After a &lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt; completes, a TCP connection can be seen in the &lt;code class=&quot;language-text&quot;&gt;ESTAB&lt;/code&gt; state.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ss -tnp
State  Recv-Q  Send-Q  Local Address:Port  Peer Address:Port
ESTAB  0       0       172.18.0.4:54304    172.18.0.3:3306   users:&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ruby&quot;&lt;/span&gt;,pid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;11683,fd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;13&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now we stop the database, and make another call to &lt;code class=&quot;language-text&quot;&gt;GET /passengers&lt;/code&gt;. We run &lt;code class=&quot;language-text&quot;&gt;ss&lt;/code&gt; when the request is in flight, and observe another TCP connection for the request to the port Rails listens on, port &lt;code class=&quot;language-text&quot;&gt;3000&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ss -tnp
State  Recv-Q  Send-Q  Local Address:Port  Peer Address:Port
ESTAB  0       0       172.18.0.4:54304    172.18.0.3:3306   users:&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ruby&quot;&lt;/span&gt;,pid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;11683,fd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;13&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;
ESTAB  0       0       172.18.0.4:3000     172.18.0.1:60878  users:&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ruby&quot;&lt;/span&gt;,pid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;11683,fd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;12&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;After &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; has elapsed, we see that a new connection is established to the database, and the first one has transitioned to a &lt;code class=&quot;language-text&quot;&gt;FIN-WAIT&lt;/code&gt; state. This new TCP connection is in the &lt;code class=&quot;language-text&quot;&gt;ESTAB&lt;/code&gt; state (line 3), because we have only stopped the database on the application layer, but the sockets to the container still accept the TCP handshake on the transport layer.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ss -tnp
State       Recv-Q  Send-Q  Local Address:Port  Peer Address:Port
FIN-WAIT-2  0       0       172.18.0.4:54304    172.18.0.3:3306
ESTAB       0       0       172.18.0.4:54308    172.18.0.3:3306   users:&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ruby&quot;&lt;/span&gt;,pid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;11683,fd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;13&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;
ESTAB       0       0       172.18.0.4:3000     172.18.0.1:60878  users:&lt;span class=&quot;token punctuation&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ruby&quot;&lt;/span&gt;,pid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;11683,fd&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;12&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;After &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; has elapsed, the request terminates with a 500 error, and we observe that all the connections are in the &lt;code class=&quot;language-text&quot;&gt;FIN-WAIT&lt;/code&gt; state.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;
      &lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ ss -tnp
State       Recv-Q  Send-Q  Local Address:Port  Peer Address:Port
FIN-WAIT-2  0       0       172.18.0.4:54310    172.18.0.3:3306
FIN-WAIT-2  0       0       172.18.0.4:54304    172.18.0.3:3306
FIN-WAIT-2  0       0       172.18.0.4:54308    172.18.0.3:3306&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The experimental data can be found &lt;a href=&quot;#experimental-data&quot;&gt;below&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;findings&quot;&gt;&lt;a href=&quot;#findings&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Findings&lt;/h4&gt;
&lt;p&gt;It’s worth noting that when setting &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;database.yml&lt;/code&gt;, there is a difference between empty values and the case where the key is missing entirely in the file. If the values are empty, scenario 1 will fail to terminate after 5 minutes, but if the keys are absent, scenario 1 will fail after 120 seconds, which is the default for &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt;.&lt;/p&gt;
&lt;h5 id=&quot;experiment-1-findings&quot;&gt;&lt;a href=&quot;#experiment-1-findings&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Experiment 1 Findings&lt;/h5&gt;
&lt;p&gt;The request waits for &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; to connect to the database, where the default value (when not specified) is indeed 120 seconds.&lt;/p&gt;
&lt;p&gt;As expected, connecting to the database with no existing connections is independent of the &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt;.&lt;/p&gt;
&lt;h5 id=&quot;experiment-2-findings&quot;&gt;&lt;a href=&quot;#experiment-2-findings&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Experiment 2 Findings&lt;/h5&gt;
&lt;p&gt;The request waits for &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; + &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; before failing. This is because the connection pool waits for &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; on the existing connection before terminating it, and then waits for &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; as it tries to establish a new connection to &lt;code class=&quot;language-text&quot;&gt;db_other&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;analysis&quot;&gt;&lt;a href=&quot;#analysis&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Analysis&lt;/h2&gt;
&lt;p&gt;With these findings, we can try to understand how the lack of these timeouts affected our Rails server in production during and after the database failover.&lt;/p&gt;
&lt;h3 id=&quot;establishing-terms&quot;&gt;&lt;a href=&quot;#establishing-terms&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Establishing Terms&lt;/h3&gt;
&lt;p&gt;Our application server constantly receives requests, out of which a certain percentage of requests will trigger the code to connect to the affected database, which we’ll call &lt;em&gt;x&lt;/em&gt;-type requests. The other requests, that do not trigger a database connection, we’ll call &lt;em&gt;x’&lt;/em&gt;-type requests.&lt;/p&gt;
&lt;h3 id=&quot;analysis-1&quot;&gt;&lt;a href=&quot;#analysis-1&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Analysis&lt;/h3&gt;
&lt;p&gt;With the background knowledge gathered in our experiments, let’s try to analyse all the steps that happened during our production outage.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Rails started from a clean state, with no connections set up to the database initially&lt;/li&gt;
&lt;li&gt;Rails handles the first few &lt;em&gt;x&lt;/em&gt; request types, opens a connection to the database&lt;/li&gt;
&lt;li&gt;Subsequent requests of &lt;em&gt;x&lt;/em&gt; type can reuse the same connections from the connection pool&lt;/li&gt;
&lt;li&gt;At a certain time, due to a hardware fault out of our control, a failover of the database is triggered&lt;/li&gt;
&lt;li&gt;At the same time requests of &lt;em&gt;x&lt;/em&gt; type comes in — and ActiveRecord reuses the same database connection from the pool, but there is no response. It then waits for &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt;, causing the thread to be stuck waiting for the default timeout&lt;/li&gt;
&lt;li&gt;Even though Rails can process requests of the &lt;em&gt;x’&lt;/em&gt; type normally, more and more requests of &lt;em&gt;x&lt;/em&gt; type come in and cause more and more threads to be stuck waiting&lt;/li&gt;
&lt;li&gt;Eventually, all the available threads to handle requests are stuck waiting on the TCP connection to the failed database, and Rails can no longer respond to new requests&lt;/li&gt;
&lt;li&gt;After the default &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; has elapsed (3 × 10 minutes), some threads will be released to handle new requests&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Subsequent requests of &lt;em&gt;x&lt;/em&gt; type will cause a new connection to be opened to the database&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If the failover is complete and the DNS records for the new instance has been updated, the new connections will be established&lt;/li&gt;
&lt;li&gt;If the failover is not complete or the DNS records were not updated, the TCP connections will still try to connect to the old IP address with the failed database instance. The connections will wait for the &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; (default 120 seconds) to elapse before failing&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Finally, once all the threads are stuck, our Rails application stops responding to all requests until it was restarted manually&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&quot;solution&quot;&gt;&lt;a href=&quot;#solution&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Solution&lt;/h4&gt;
&lt;p&gt;To fix the problem, we have to prevent our database connections from being stuck in trying to read from an unresponsive socket, and trying to connect to a closed socket.&lt;/p&gt;
&lt;p&gt;This can be done by simply setting the &lt;code class=&quot;language-text&quot;&gt;read_timeout&lt;/code&gt; so that when the database fails, existing connections and threads will be released. The &lt;code class=&quot;language-text&quot;&gt;connect_timeout&lt;/code&gt; also has to be set so that when the existing connections are released, new connections and threads handling the requests will not be stuck trying to connect to the same unavailable database.&lt;/p&gt;
&lt;p&gt;We set the following values in our staging environment and manually triggered a database failover via the AWS console, and observed that requests of the &lt;em&gt;x’&lt;/em&gt; type are no longer stalled during the failover.&lt;/p&gt;
&lt;p&gt;The following is a snippet for our current &lt;code class=&quot;language-text&quot;&gt;database.yml&lt;/code&gt; configuration before the outage, and the changes to resolve the problem.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;
      &lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Config for the non-primary `db_other` database&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;production_other&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mysql2
  &lt;span class=&quot;token key atrule&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; utf8
  &lt;span class=&quot;token key atrule&quot;&gt;reconnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;database&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; …
  &lt;span class=&quot;token key atrule&quot;&gt;pool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; …
  &lt;span class=&quot;token key atrule&quot;&gt;reaping_frequency&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;120&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; …
  &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; …
  &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; …&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;
      &lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# New changes&lt;/span&gt;
+ connect_timeout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
+ read_timeout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this post, we have gone over how timeouts are handled by the ActiveRecord ORM with our MySQL database and how failing to configure them brought down some of our production systems.&lt;/p&gt;
&lt;p&gt;Timeouts are very important configurations when setting up distributed systems and they are easily overlooked in the initial deployments of such applications.&lt;/p&gt;
&lt;p&gt;These principles are not just limited to Rails or MySQL, and the experiments and their findings can be easily extended to other technologies as well. Needless to say, these timeout settings are extremely important for the resiliency of applications in the world of micro services.&lt;/p&gt;
&lt;h2 id=&quot;references&quot;&gt;&lt;a href=&quot;#references&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ankane/the-ultimate-guide-to-ruby-timeouts&quot;&gt;ankane/the-ultimate-guide-to-ruby-timeouts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ankane/production_rails&quot;&gt;ankane/production_rails&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/mysql-options.html&quot;&gt;MySQL Reference Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/zach14c/mysql/blob/mysql-5.7/include/mysql_com.h#L298&quot;&gt;MySQL Source Code Mirror&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.confirm.ch/tcp-connection-states/&quot;&gt;TCP Connection States&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Big thanks to &lt;a href=&quot;https://github.com/lowjoel&quot;&gt;Joel Low&lt;/a&gt; for helping out with this investigation and clarifying ambiguities in Rails and MySQL, and my manager Amit Saini for his helpful review of this post!&lt;/p&gt;
&lt;p&gt;Cover photo by &lt;a href=&quot;https://unsplash.com/photos/Vc8jfmzWoFE&quot;&gt;Artem Verbo&lt;/a&gt; on &lt;a href=&quot;https://unsplash.com/&quot;&gt;Unsplash&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Source code for the test rails application can be found &lt;a href=&quot;https://github.com/grab/blogs/tree/master/2017-01-29-deep-dive-into-database-timeouts-in-rails&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Mocking Modules with Jest]]></title><description><![CDATA[When I was working on building full stack web applications at  Grab , I noticed that even though mocking function calls in Ruby on Rails is…]]></description><link>http://iapploft.net/bak/2018-01-23-mocking-modules-with-jest/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-01-23-mocking-modules-with-jest/</guid><pubDate>Tue, 23 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;When I was working on building full stack web applications at &lt;a href=&quot;https://www.grab.com&quot;&gt;Grab&lt;/a&gt;, I noticed that even though mocking function calls in Ruby on Rails is rather idiomatic, it is less so for the Javascript ecosystem. Sometimes, we might have some utility functions which makes a external HTTP call which we want to mock out in our tests, but how do we do it in Javascript?&lt;/p&gt;
&lt;h2 id=&quot;ruby-example&quot;&gt;&lt;a href=&quot;#ruby-example&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ruby Example&lt;/h2&gt;
&lt;p&gt;Let’s look at what we want to do in Ruby first before “translating” it to Javascript.&lt;/p&gt;
&lt;p&gt;Ruby on Rails applications typically use &lt;a href=&quot;https://github.com/rspec/rspec&quot;&gt;RSpec&lt;/a&gt; as a testing framework where we can easily mock out code.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;
      &lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# http_client.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;HTTPClient&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; make_http_call
    &lt;span class=&quot;token comment&quot;&gt;# makes a http call, returns a number&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;
      &lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# module.rb&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; add_one_to_http_call
  res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; make_http_call
  res &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;
      &lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# module_spec.rb&lt;/span&gt;
describe &lt;span class=&quot;token string&quot;&gt;&apos;add_one_to_http_call&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  before &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HTTPClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;to_recieve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:make_http_call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and_return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  it &lt;span class=&quot;token string&quot;&gt;&apos;adds one to the response&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; add_one_to_http_call
    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;res&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to &lt;span class=&quot;token function&quot;&gt;eq&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2 id=&quot;jest&quot;&gt;&lt;a href=&quot;#jest&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Jest&lt;/h2&gt;
&lt;p&gt;However, doing the same in Javascript seems to be less obvious, and I had to take some time to figure this out.&lt;/p&gt;
&lt;p&gt;Let’s try to write the same code in Javascript. We will use &lt;a href=&quot;https://facebook.github.io/jest/&quot;&gt;Jest&lt;/a&gt; as the test framework for our tests.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// dependency.js&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// makeHttpCall is an example function which should not be called, and should be mocked out in&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// our tests&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;makeHttpCall&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;We will illustrate this example with both default and named exports.&lt;/p&gt;
&lt;h3 id=&quot;default-exports&quot;&gt;&lt;a href=&quot;#default-exports&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Default Exports&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// module.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; makeHttpCall &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;addOneToHttpCall&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeHttpCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; addOneToHttpCall&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// module.test.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; addOneToHttpCall &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./module&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; makeHttpCall &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mock is called&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;addOneToHttpCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalledTimes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;By calling &lt;a href=&quot;https://facebook.github.io/jest/docs/en/jest-object.html#jestmockmodulename-factory-options&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;jest.mock()&lt;/code&gt;&lt;/a&gt;, we can setup what is exported as a &lt;a href=&quot;https://facebook.github.io/jest/docs/en/mock-function-api.html&quot;&gt;mock function&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;named-exports&quot;&gt;&lt;a href=&quot;#named-exports&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Named Exports&lt;/h3&gt;
&lt;p&gt;Similarly, this can be done with named exports.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// module.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; makeHttpCall &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./../dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;addOneToHttpCall&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeHttpCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; addOneToHttpCall&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// module.test.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; addOneToHttpCall &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./module&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; makeHttpCall &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mock is called&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;addOneToHttpCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHaveBeenCalledTimes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Note that calling &lt;code class=&quot;language-text&quot;&gt;jest.mock(‘./dependency’)&lt;/code&gt; will replace all exported functions of &lt;code class=&quot;language-text&quot;&gt;dependency.js&lt;/code&gt; with mock functions.&lt;/p&gt;
&lt;p&gt;What if there is another arbitrary named export in &lt;code class=&quot;language-text&quot;&gt;dependency.js&lt;/code&gt;, a &lt;code class=&quot;language-text&quot;&gt;split()&lt;/code&gt; function that we do not want to mock?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// dependency.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;makeHttpCall&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; delimiter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; inp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;delimiter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Simply call &lt;code class=&quot;language-text&quot;&gt;jest.mock&lt;/code&gt; with a second argument, using &lt;a href=&quot;https://facebook.github.io/jest/docs/en/api.html#requirerequireactualmodulename&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;require.requireActual&lt;/code&gt;&lt;/a&gt; to retain the value of the original function. Props to &lt;a href=&quot;https://paradite.com/&quot;&gt;Paradite&lt;/a&gt; for teaching me how to do this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// module.test.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; addOneToHttpCall &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./index&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; split &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./../dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./../dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  split&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; require&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requireActual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./../dependency&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;only mock the value of makeHttpCall()&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  makeHttpCall&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockReturnValueOnce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addOneToHttpCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;split() still works as intended&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a,b,c&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;,&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;c&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-hidden=&quot;true&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Hopefully this short blog post illustrates how mocking in Jest can be just as easy as how we do it in RSpec. Let me know at &lt;a href=&quot;https://twitter.com/jiahaog&quot;&gt;@jiahaog&lt;/a&gt; if you have any feedback regarding this!&lt;/p&gt;
&lt;p&gt;Accompanying source code can be found &lt;a href=&quot;https://github.com/jiahaog/jest-mock-example&quot;&gt;here&lt;/a&gt;!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Hello Blog World!]]></title><description><![CDATA[Finally getting around to starting a proper blog to keep track of the things I’ve learnt on this journey. It’s time to stop writing random…]]></description><link>http://iapploft.net/bak/2018-01-22-hello-world/</link><guid isPermaLink="false">http://iapploft.net/bak/2018-01-22-hello-world/</guid><pubDate>Mon, 22 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Finally getting around to starting a proper blog to keep track of the things I’ve learnt on this journey. It’s time to stop writing random scripts in my &lt;a href=&quot;https://gist.github.com/jiahaog&quot;&gt;GitHub Gist&lt;/a&gt; for just personal reference and instead share them with the world!&lt;/p&gt;</content:encoded></item></channel></rss>